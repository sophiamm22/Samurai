(function(){var i,r,n,u,f={}.hasOwnProperty,t=function(n,t){function r(){this.constructor=n}for(var i in t)f.call(t,i)&&(n[i]=t[i]);return r.prototype=t.prototype,n.prototype=new r,n.__super__=t.prototype,n};i=function(){function n(n,t){this.odds=n,this.prob=t,this.edge=this.odds*this.prob-1}return n}(),n=function(){function n(){}return n.singleKellyStakes=function(n,t){if(n)return n.map(function(n){return n.edge>=this.minEdge?Math.max((Math.pow((n.odds-1)*n.prob,t)-Math.pow(1-n.prob,t))/(Math.pow(n.win*n.prob,t)+(n.odds-1)*Math.pow(1-n.prob,t)),0):0})},n}(),u=function(n){function i(n,t,i){this.kellyMultiplier=n,this.minEdge=t,this.calculatedBets=i!=null?i:[],this.noBets=this.calculatedBets.length,this.singleKellyStakes,this.realKellyStakes}var f,u,r;return t(i,n),r=200,u=200,f=300,i.prototype.calcSingleKellyStakes=function(n,t,i){return n.map(function(n){return n.edge>=i?Math.max((Math.pow((n.odds-1)*n.prob,t)-Math.pow(1-n.prob,t))/(Math.pow((n.odds-1)*n.prob,t)+(n.odds-1)*Math.pow(1-n.prob,t)),0):0})},i.prototype.sum=function(n){return n.length===0?0:n.reduce(function(n,t){return n+t})},i.prototype.sign=function(n){return n&&n/Math.abs(n)},i.prototype.normaliseKelly=function(n){var t;return t=this.sum(n),n.map(function(n){return t>1?n/t:n})},i.prototype.learningRate=function(n,t,i){return i||(i=0),i*(this.sign(n)===this.sign(t)?1.05:.95)},i.prototype.slopes=function(n,t){var f,w,c,b,e,o,i,s,u,h,l,a,v,y,p,k,d,g;for(c=[],e=[],w=[],u=[],o=[],i=l=0;l<n;i=l+=1){for(s=[],h=[],t=a=0,k=this.noBets;a<k;t=a+=1)b=Math.random(),f=this.calculatedBets[t],b<f.prob?(s[t]=f.odds-1,h[t]=(f.odds-1)*this.realKellyStakes[t]):(s[t]=-1,h[t]=-this.realKellyStakes[t]);for(c[i]=this.sum(h),e[i]=c[i]+1,w[i]=Math.log(e[i])/r,t=v=0,d=this.noBets;v<d;t=v+=1)u[i]||(u[i]=[]),u[i][t]=s[t]/(r*e[i])}for(t=y=0,g=this.noBets;y<g;t=y+=1)for(o[t]=0,n=p=0;p<r;n=p+=1)o[t]+=u[n][t];return o},i.prototype.calculateKelly=function(){var n,p,i,t,f,w,o,e,s,h,c,l,a,v,y,b,k,d;for(this.singleKellyStakes=this.calcSingleKellyStakes(this.calculatedBets,1,0),this.realKellyStakes=this.normaliseKelly(this.singleKellyStakes),p=[],f=[],s=[],c=[],t=[],i=[],o=l=0;l<u;o=l+=1){for(e=this.slopes(r,this.noBets),n=a=0,b=this.noBets;a<b;n=a+=1)f[n]=o===0?1:this.learningRate(i[n],e[n],i[n]),s[n]=this.singleKellyStakes[n]-this.realKellyStakes[n],c[n]=this.sign(e[n])*f[n]*s[n],t[n]=this.realKellyStakes[n]+c[n];for(h=this.sum(t),w=h>1?.99/h:1,n=v=0,k=this.noBets;v<k;n=v+=1)this.realKellyStakes[n]=t[n]<0?0:t[n]*w;p=f,i=e}if(this.kellyMultiplier!==1)for(n=y=0,d=this.noBets;y<d;n=y+=1)this.realKellyStakes[n]=this.kellyMultiplier*this.realKellyStakes[n];return this.realKellyStakes},i}(n),r=function(n){function i(n,t,i){this.kellyMultiplier=n,this.minEdge=t,this.calculatedBets=i!=null?i:[],this.realKellyStakes}return t(i,n),i.prototype.calcSingleKellyStakes=function(n,t,i){if(n)return n.map(function(n){return!i||n.edge>=i?Math.max((Math.pow((n.odds-1)*n.prob,t)-Math.pow(1-n.prob,t))/(Math.pow((n.odds-1)*n.prob,t)+(n.odds-1)*Math.pow(1-n.prob,t)),0):0})},i.prototype.bitImp=function(n,t){return~n|t},i.prototype.toRadix=function(n,t){var i,r,u;for(i="",r=Math.floor(Math.abs(n)),u=void 0;;)if(u=r%t,i="0123456789abcdefghijklmnopqrstuvwxyz".charAt(u)+i,r=(r-u)/t,r===0)break;return n<0?"-"+i:i},i.prototype.parlaySize=function(n){return this.toRadix(n,2).split("").reduce(function(n,t){return parseInt(n)+parseInt(t)})},i.prototype.calculateKelly=function(){var d,n,s,f,g,nt,i,h,t,c,u,e,l,r,o,tt,a,v,y,p,w,b,k,it;for(r=calculatedBets.length,d=Math.pow(2,r)-1,l=[],h=[],i=[],u=[],l=this.calcSingleKellyStakes(this.calculatedBets,this.kellyMultiplier,this.minEdge),n=a=0;a<r;n=a+=1)i[n]=[];for(n=v=1;v<=d;n=v+=1)nt=parseInt(this.parlaySize(n)),i[nt-1].push(n);for(e=y=r;y>=1;e=y+=-1)for(g=i[e-1].length,n=p=0;p<g;n=p+=1){for(t=i[e-1][n],u[t]=1,h[t]="",f=w=0;w<r;f=w+=1)this.bitImp(Math.pow(2,f),t)===-1&&(u[t]*=l[f],h[t]+=f+1+"+");for(o=b=it=e+1;b<=r;o=b+=1)for(tt=i[o-1].length,s=k=0;k<tt;s=k+=1)c=i[o-1][s],this.bitImp(t,c)===-1&&(u[t]-=u[c])}return u.slice(0,r)},i}(n)}).call(this)