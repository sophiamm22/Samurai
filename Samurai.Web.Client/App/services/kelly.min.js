(function(){var i,r,n,u,f={}.hasOwnProperty,t=function(n,t){function r(){this.constructor=n}for(var i in t)f.call(t,i)&&(n[i]=t[i]);return r.prototype=t.prototype,n.prototype=new r,n.__super__=t.prototype,n};i=function(){function n(n,t){this.odds=n,this.prob=t,this.edge=this.odds*this.prob-1}return n}(),n=function(){function n(){}return n.singleKellyStakes=function(n,t){if(n)return n.map(function(n){return n.edge>=this.minEdge?Math.max((Math.pow((n.odds-1)*n.prob,t)-Math.pow(1-n.prob,t))/(Math.pow(n.win*n.prob,t)+(n.odds-1)*Math.pow(1-n.prob,t)),0):0})},n}(),u=function(n){function i(n,t,i){this.kellyMultiplier=n,this.minEdge=t,this.calculatedBets=i!=null?i:{},this.realKellyStakes}var f,r,u;return t(i,n),u=200,r=200,f=300,i.calcSingleKellyStakes=function(n,t,i){return n.map(function(n){return n.edge>=i?Math.max((Math.pow((n.odds-1)*n.prob,t)-Math.pow(1-n.prob,t))/(Math.pow(n.win*n.prob,t)+(n.odds-1)*Math.pow(1-n.prob,t)),0):0})},i.prototype.sum=function(n){return n.length===0?0:n.reduce(function(n,t){return n+t})},i.prototype.normaliseKelly=function(n){var t;return t=sum(n),n.map(function(n){return t>1?n/t:n})},i.prototype.noBets=function(){if(this.calculatedBets)return this.calculatedBets.length},i.prototype.singleKellyStakes=function(){return this.normaliseKelly(this.calcSingleKellyStakes(this.calculatedBets,1))},i.prototype.learningRate=function(n,t,i){return i*(Math.sign(n)===Math.sign(slop)?1.05:.95)},i.prototype.slopes=function(n,t){var o,v,h,y,c,l,i,a,p,s,r,f,e;for(h={},c={},v={},p={},l={},i=r=0;0<=n?r<n:r>n;i=0<=n?++r:--r)for(a={},s={},t=f=0;0<=noBets?f<noBets:f>noBets;t=0<=noBets?++f:--f)y=Math.random(),o=this.calculatedBets[t],y<o.prob?(a[t]=o.odds-1,s[t]=(o.odds-1)*this.realKellyStakes[t]):(a[t]=-1,s[t]=-this.realKellyStakes[t]);for(h[i]=sum(s),c[i]=h[i]+1,v[i]=Math.log(c[i])/u,t=e=0;0<=noBets?e<noBets:e>noBets;t=0<=noBets?++e:--e)l[t]=sum(p.transpose()[t]);return l},i.prototype.calculateKelly=function(){for(var s,n,p,h,t,o,w,l,a,v,y,i,f,e,c=i=0;0<=r?i<r:i>r;c=0<=r?++i:--i){for(p={},o={},a={},y={},t={},h={},l=slopes(u,noBets),n=f=0;0<=noBets?f<noBets:f>noBets;n=0<=noBets?++f:--f)o[n]=c?learningRate(h[n],l[n],h[n]):1,s=singleKellyStakes[n],a[n]=singleKellyStakes[n]-s,y[n]=Math.sign(l[n])*o[n]*a[n],t[n]=s+y[n],v=sum(t),w=v>1?.99/v:1;for(n=e=0;0<=noBets?e<noBets:e>noBets;n=0<=noBets?++e:--e)this.realKellyStakes[n]=t[n]<0?0:t[n]*w;p=o}return this.realKellyStakes},i}(n),r=function(n){function i(n,t,i){this.kellyMultiplier=n,this.minEdge=t,this.calculatedBets=i!=null?i:{},this.realKellyStakes}return t(i,n),i.prototype.calcSingleKellyStakes=function(n,t,i){if(n)return n.map(function(n){return n.edge>=i?Math.max((Math.pow((n.odds-1)*n.prob,t)-Math.pow(1-n.prob,t))/(Math.pow((n.odds-1)*n.prob,t)+(n.odds-1)*Math.pow(1-n.prob,t)),0):0})},i.prototype.bitImp=function(n,t){return~n|t},i.prototype.toRadix=function(n,t){var i,r,u;for(i="",r=Math.floor(Math.abs(n)),u=void 0;;)if(u=r%t,i="0123456789abcdefghijklmnopqrstuvwxyz".charAt(u)+i,r=(r-u)/t,r===0)break;return n<0?"-"+i:i},i.prototype.parlaySize=function(n){return this.toRadix(n,2).split("").reduce(function(n,t){return n||0+t})},i.prototype.calculateKelly=function(){var w,n,o,r,b,f,t,d,s,g,u,k,i,e,h,c,l,a,v,y,p,nt;for(i=calculatedBets.length,w=Math.pow(2,i),k={},d={},t=[],g={},k=this.calcSingleKellyStakes(this.calculatedBets,this.kellyMultiplier,this.minEdge),n=h=1;h<=i;n=h+=1)t[n]=[];for(n=c=1;c<=w;n=c+=1)f=parseInt(this.parlaySize(n)),t[f-1]||(t[f-1]=[]),t[f-1].push(n);for(u=l=i;l>=1;u=l+=-1)for(b=t[u-1].length,n=a=0;a<b;n=a+=1){for(this.parlayNumber=this.parlayMap[u-1][n],this.realKellyStakes[parlayNumber]=1,this.parlayNames[parlayNumber]="",r=v=0;v<=i;r=v+=1)Math.pow(this.bitImp(2,r),this.parlayNumber)===-1&&(this.realKellyStakes[parlayNumber]*=this.singleKellyStakes[r],this.parlayNames[this.parlayNumber]+=r+1+"+");for(e=y=nt=u+1;y<=i;e=y+=1)for(this.ssLimit=this.parlayMaps[e-1].length,o=p=0;p<ssLimit;o=p+=1)s=t[e-1][o],this.bitImp(parlayNumber,s===-1)&&(this.realKellyStakes[parlayNumber]-=this.realKellyStakes[s])}return this.realKellyStakes},i}(n)}).call(this)