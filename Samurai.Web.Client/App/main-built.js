/**
 * almond 0.2.0 Copyright (c) 2011, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/jrburke/almond for details
 */

/**
 * @license RequireJS text 2.0.3 Copyright (c) 2010-2012, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/requirejs/text for details
 */

(function(){var e,t,n;(function(r){function i(e,t){var n,r,i,o,a,s,c,l,d,u,f=t&&t.split("/"),p=y.map,v=p&&p["*"]||{};if(e&&"."===e.charAt(0)&&t){for(f=f.slice(0,f.length-1),e=f.concat(e.split("/")),l=0;e.length>l;l+=1)if(u=e[l],"."===u)e.splice(l,1),l-=1;else if(".."===u){if(1===l&&(".."===e[2]||".."===e[0]))break;l>0&&(e.splice(l-1,2),l-=2)}e=e.join("/")}if((f||v)&&p){for(n=e.split("/"),l=n.length;l>0;l-=1){if(r=n.slice(0,l).join("/"),f)for(d=f.length;d>0;d-=1)if(i=p[f.slice(0,d).join("/")],i&&(i=i[r])){o=i,a=l;break}if(o)break;!s&&v&&v[r]&&(s=v[r],c=l)}!o&&s&&(o=s,a=c),o&&(n.splice(0,a,o),e=n.join("/"))}return e}function o(e,t){return function(){return p.apply(r,w.call(arguments,0).concat([e,t]))}}function a(e){return function(t){return i(t,e)}}function s(e){return function(t){m[e]=t}}function c(e){if(g.hasOwnProperty(e)){var t=g[e];delete g[e],b[e]=!0,f.apply(r,t)}if(!m.hasOwnProperty(e)&&!b.hasOwnProperty(e))throw Error("No "+e);return m[e]}function l(e){var t,n=e?e.indexOf("!"):-1;return n>-1&&(t=e.substring(0,n),e=e.substring(n+1,e.length)),[t,e]}function d(t,n,r){e.onResourceLoad&&t&&e.onResourceLoad({defined:n},{id:t},r)}function u(e){return function(){return y&&y.config&&y.config[e]||{}}}var f,p,v,h,m={},g={},y={},b={},w=[].slice;v=function(e,t){var n,r=l(e),o=r[0];return e=r[1],o&&(o=i(o,t),n=c(o)),o?e=n&&n.normalize?n.normalize(e,a(t)):i(e,t):(e=i(e,t),r=l(e),o=r[0],e=r[1],o&&(n=c(o))),{f:o?o+"!"+e:e,n:e,pr:o,p:n}},h={require:function(e){return o(e)},exports:function(e){var t=m[e];return t!==void 0?t:m[e]={}},module:function(e){return{id:e,uri:"",exports:m[e],config:u(e)}}},f=function(e,t,n,i){var a,l,u,f,p,y,w=[];if(i=i||e,"function"==typeof n){for(t=!t.length&&n.length?["require","exports","module"]:t,p=0;t.length>p;p+=1)if(f=v(t[p],i),l=f.f,"require"===l)w[p]=h.require(e);else if("exports"===l)w[p]=h.exports(e),y=!0;else if("module"===l)a=w[p]=h.module(e);else if(m.hasOwnProperty(l)||g.hasOwnProperty(l)||b.hasOwnProperty(l))w[p]=c(l);else{if(!f.p)throw Error(e+" missing "+l);f.p.load(f.n,o(i,!0),s(l),{}),w[p]=m[l]}u=n.apply(m[e],w),e&&(a&&a.exports!==r&&a.exports!==m[e]?m[e]=a.exports:u===r&&y||(m[e]=u))}else e&&(m[e]=n);d(e,m,w)},e=t=p=function(e,t,n,i,o){return"string"==typeof e?h[e]?h[e](t):c(v(e,t).f):(e.splice||(y=e,t.splice?(e=t,t=n,n=null):e=r),t=t||function(){},"function"==typeof n&&(n=i,i=o),i?f(r,e,t,n):setTimeout(function(){f(r,e,t,n)},15),p)},p.config=function(e){return y=e,p},n=function(e,t,n){t.splice||(n=t,t=[]),g[e]=[e,t,n]},n.amd={jQuery:!0}})(),n("durandal/amd/almond-custom",function(){}),n("config",[],function(){toastr.options.timeOut=4e3,toastr.options.positionClass="toast-bottom-right";var e=[{url:"today",moduleId:"viewmodels/today",name:"Today",visible:!0,caption:"Today",settings:{id:"today-button"}},{url:"performance",moduleId:"viewmodels/performance",name:"Performance",visible:!0,caption:"Performance",settings:{id:"performance-button"}},{url:"free-bets",moduleId:"viewmodels/today",name:"Free Bets",visible:!0,caption:"Free Bets",settings:{id:"free-bets-button"}},{url:"free-bets",moduleId:"viewmodels/today",name:"Blog",visible:!0,caption:"Free Bets",settings:{id:"blog-button",url:"http://blog.valuesamurai.com"}},{url:"today/competition/:competition",moduleId:"viewmodels/today",name:"Today"},{url:"today/sport/:sport",moduleId:"viewmodels/today",name:"Today"}],t="today",n=location.hostname.match("localhost")?"http://localhost:3600/api":"http://samuraiapi.apphb.com/api",r=location.hostname.match("localhost")?"http://localhost:3600/signalr":"http://samuraiapi.apphb.com/signalr",i={today:"#/today",todayByCompetition:"#/today/competition",todayBySport:"#/today/sport"},o=400,a=70,s=.2,c=.25,l=7,d=1e3;return{routes:e,startModule:t,remoteServiceName:n,hashes:i,throttle:o,signalrServiceName:r,minTennisGames:a,minEdgeTennis:s,kellyMultiplier:c,exhaustiveKellyLimit:l,startBank:d}}),n("main-built",function(){}),n("durandal/system",["require"],function(t){var n,r=!1,i=Object.keys,o=Object.prototype.hasOwnProperty,a=Object.prototype.toString,s=!1;if(Function.prototype.bind&&("object"==typeof console||"function"==typeof console)&&"object"==typeof console.log)try{["log","info","warn","error","assert","dir","clear","profile","profileEnd"].forEach(function(e){console[e]=this.call(console[e],console)},Function.prototype.bind)}catch(c){s=!0}t.on&&t.on("moduleLoaded",function(e,t){n.setModuleId(e,t)}),e!==void 0&&(e.onResourceLoad=function(e,t){n.setModuleId(e.defined[t.id],t.id)});var l=function(){},d=function(){try{if("undefined"!=typeof console&&"function"==typeof console.log)if(window.opera)for(var e=0;arguments.length>e;)console.log("Item "+(e+1)+": "+arguments[e]),e++;else 1==Array.prototype.slice.call(arguments).length&&"string"==typeof Array.prototype.slice.call(arguments)[0]?console.log(""+Array.prototype.slice.call(arguments)):console.log(Array.prototype.slice.call(arguments));else Function.prototype.bind&&!s||"undefined"==typeof console||"object"!=typeof console.log||Function.prototype.call.call(console.log,console,Array.prototype.slice.call(arguments))}catch(t){}};return n={version:"1.2.0",noop:l,getModuleId:function(e){return e?"function"==typeof e?e.prototype.__moduleId__:"string"==typeof e?null:e.__moduleId__:null},setModuleId:function(e,t){return e?"function"==typeof e?(e.prototype.__moduleId__=t,void 0):("string"!=typeof e&&(e.__moduleId__=t),void 0):void 0},debug:function(e){return 1!=arguments.length?r:(r=e,r?(this.log=d,this.log("Debug mode enabled.")):(this.log("Debug mode disabled."),this.log=l),void 0)},isArray:function(e){return"[object Array]"===a.call(e)},log:l,defer:function(e){return $.Deferred(e)},guid:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=0|16*Math.random(),n="x"==e?t:8|3&t;return n.toString(16)})},acquire:function(){var e=Array.prototype.slice.call(arguments,0);return this.defer(function(n){t(e,function(){var e=arguments;setTimeout(function(){n.resolve.apply(n,e)},1)})}).promise()}},n.keys=i||function(e){if(e!==Object(e))throw new TypeError("Invalid object");var t=[];for(var n in e)o.call(e,n)&&(t[t.length]=n);return t},n}),n("durandal/viewEngine",["./system"],function(e){var t;return t=$.parseHTML?function(e){return $.parseHTML(e)}:function(e){return $(e).get()},{viewExtension:".html",viewPlugin:"text",isViewUrl:function(e){return-1!==e.indexOf(this.viewExtension,e.length-this.viewExtension.length)},convertViewUrlToViewId:function(e){return e.substring(0,e.length-this.viewExtension.length)},convertViewIdToRequirePath:function(e){return this.viewPlugin+"!"+e+this.viewExtension},parseMarkup:function(e){var n=t(e);if(1==n.length)return n[0];for(var r=[],i=0;n.length>i;i++){var o=n[i];if(8!=o.nodeType){if(3==o.nodeType){var a=/\S/.test(o.nodeValue);if(!a)continue}r.push(o)}}return r.length>1?$(r).wrapAll('<div class="durandal-wrapper"></div>').parent().get(0):r[0]},createView:function(t){var n=this,r=this.convertViewIdToRequirePath(t);return e.defer(function(i){e.acquire(r).then(function(e){var r=n.parseMarkup(e);r.setAttribute("data-view",t),i.resolve(r)})}).promise()}}}),n("durandal/viewLocator",["./system","./viewEngine"],function(e,t){function n(e,t){for(var n=0;e.length>n;n++){var r=e[n],i=r.getAttribute("data-view");if(i==t)return r}}function r(e){return(e+"").replace(/([\\\.\+\*\?\[\^\]\$\(\)\{\}\=\!\<\>\|\:])/g,"\\$1")}return{useConvention:function(e,t,n){e=e||"viewmodels",t=t||"views",n=n||t;var i=RegExp(r(e),"gi");this.convertModuleIdToViewId=function(e){return e.replace(i,t)},this.translateViewIdToArea=function(e,t){return t&&"partial"!=t?n+"/"+t+"/"+e:n+"/"+e}},locateViewForObject:function(t,n){var r;if(t.getView&&(r=t.getView()))return this.locateView(r,null,n);if(t.viewUrl)return this.locateView(t.viewUrl,null,n);var i=e.getModuleId(t);return i?this.locateView(this.convertModuleIdToViewId(i),null,n):this.locateView(this.determineFallbackViewId(t),null,n)},convertModuleIdToViewId:function(e){return e},determineFallbackViewId:function(e){var t=/function (.{1,})\(/,n=t.exec(""+e.constructor),r=n&&n.length>1?n[1]:"";return"views/"+r},translateViewIdToArea:function(e){return e},locateView:function(r,i,o){if("string"==typeof r){var a;if(a=t.isViewUrl(r)?t.convertViewUrlToViewId(r):r,i&&(a=this.translateViewIdToArea(a,i)),o){var s=n(o,a);if(s)return e.defer(function(e){e.resolve(s)}).promise()}return t.createView(a)}return e.defer(function(e){e.resolve(r)}).promise()}}}),n("durandal/viewModelBinder",["./system"],function(e){function t(t,o,a){if(!o||!t){if(n.throwOnErrors)throw Error(r);return e.log(r,o,t),void 0}if(!o.getAttribute){if(n.throwOnErrors)throw Error(i);return e.log(i,o,t),void 0}var s=o.getAttribute("data-view");try{e.log("Binding",s,t),n.beforeBind(t,o),a(),n.afterBind(t,o)}catch(c){if(n.throwOnErrors)throw Error(c.message+";\nView: "+s+";\nModuleId: "+e.getModuleId(t));e.log(c.message,s,t)}}var n,r="Insufficient Information to Bind",i="Unexpected View Type";return n={beforeBind:e.noop,afterBind:e.noop,bindContext:function(e,n,r){r&&(e=e.createChildContext(r)),t(e,n,function(){r&&r.beforeBind&&r.beforeBind(n),ko.applyBindings(e,n),r&&r.afterBind&&r.afterBind(n)})},bind:function(e,n){t(e,n,function(){e.beforeBind&&e.beforeBind(n),ko.applyBindings(e,n),e.afterBind&&e.afterBind(n)})}}}),n("durandal/viewModel",["./system"],function(e){function t(e){return void 0==e&&(e={}),e.closeOnDeactivate||(e.closeOnDeactivate=s.defaults.closeOnDeactivate),e.beforeActivate||(e.beforeActivate=s.defaults.beforeActivate),e.afterDeactivate||(e.afterDeactivate=s.defaults.afterDeactivate),e.interpretResponse||(e.interpretResponse=s.defaults.interpretResponse),e.areSameItem||(e.areSameItem=s.defaults.areSameItem),e}function n(t,n,r,i,o){if(t&&t.deactivate){e.log("Deactivating",t);var a;try{a=t.deactivate(n)}catch(s){return e.log(s),i.resolve(!1),void 0}a&&a.then?a.then(function(){r.afterDeactivate(t,n,o),i.resolve(!0)},function(t){e.log(t),i.resolve(!1)}):(r.afterDeactivate(t,n,o),i.resolve(!0))}else t&&r.afterDeactivate(t,n,o),i.resolve(!0)}function r(t,n,r,i){if(t)if(t.activate){e.log("Activating",t);var o;try{o=t.activate(i)}catch(a){return e.log(a),r(!1),void 0}o&&o.then?o.then(function(){n(t),r(!0)},function(t){e.log(t),r(!1)}):(n(t),r(!0))}else n(t),r(!0);else r(!0)}function i(t,n,r){return e.defer(function(i){if(t&&t.canDeactivate){var o;try{o=t.canDeactivate(n)}catch(a){return e.log(a),i.resolve(!1),void 0}o.then?o.then(function(e){i.resolve(r.interpretResponse(e))},function(t){e.log(t),i.resolve(!1)}):i.resolve(r.interpretResponse(o))}else i.resolve(!0)}).promise()}function o(t,n,r,i){return e.defer(function(o){if(t==n())return o.resolve(!0),void 0;if(t&&t.canActivate){var a;try{a=t.canActivate(i)}catch(s){return e.log(s),o.resolve(!1),void 0}a.then?a.then(function(e){o.resolve(r.interpretResponse(e))},function(t){e.log(t),o.resolve(!1)}):o.resolve(r.interpretResponse(a))}else o.resolve(!0)}).promise()}function a(a,s){var c=ko.observable(null);s=t(s);var l=ko.computed({read:function(){return c()},write:function(e){l.viaSetter=!0,l.activateItem(e)}});return l.settings=s,s.activator=l,l.isActivating=ko.observable(!1),l.canDeactivateItem=function(e,t){return i(e,t,s)},l.deactivateItem=function(t,r){return e.defer(function(e){l.canDeactivateItem(t,r).then(function(i){i?n(t,r,s,e,c):(l.notifySubscribers(),e.resolve(!1))})}).promise()},l.canActivateItem=function(e,t){return o(e,c,s,t)},l.activateItem=function(t,i){var o=l.viaSetter;return l.viaSetter=!1,e.defer(function(a){if(l.isActivating())return a.resolve(!1),void 0;l.isActivating(!0);var d=c();return s.areSameItem(d,t,i)?(l.isActivating(!1),a.resolve(!0),void 0):(l.canDeactivateItem(d,s.closeOnDeactivate).then(function(u){u?l.canActivateItem(t,i).then(function(u){u?e.defer(function(e){n(d,s.closeOnDeactivate,s,e)}).promise().then(function(){t=s.beforeActivate(t,i),r(t,c,function(e){l.isActivating(!1),a.resolve(e)},i)}):(o&&l.notifySubscribers(),l.isActivating(!1),a.resolve(!1))}):(o&&l.notifySubscribers(),l.isActivating(!1),a.resolve(!1))}),void 0)}).promise()},l.canActivate=function(){var e;return a?(e=a,a=!1):e=l(),l.canActivateItem(e)},l.activate=function(){var e;return a?(e=a,a=!1):e=l(),l.activateItem(e)},l.canDeactivate=function(e){return l.canDeactivateItem(l(),e)},l.deactivate=function(e){return l.deactivateItem(l(),e)},l.includeIn=function(e){e.canActivate=function(){return l.canActivate()},e.activate=function(){return l.activate()},e.canDeactivate=function(e){return l.canDeactivate(e)},e.deactivate=function(e){return l.deactivate(e)}},s.includeIn?l.includeIn(s.includeIn):a&&l.activate(),l.forItems=function(t){s.closeOnDeactivate=!1,s.determineNextItemToActivate=function(e,t){var n=t-1;return-1==n&&e.length>1?e[1]:n>-1&&e.length-1>n?e[n]:null},s.beforeActivate=function(e){var n=l();if(e){var r=t.indexOf(e);-1==r?t.push(e):e=t()[r]}else e=s.determineNextItemToActivate(t,n?t.indexOf(n):0);return e},s.afterDeactivate=function(e,n){n&&t.remove(e)};var n=l.canDeactivate;l.canDeactivate=function(r){return r?e.defer(function(e){function n(){for(var t=0;o.length>t;t++)if(!o[t])return e.resolve(!1),void 0;e.resolve(!0)}for(var i=t(),o=[],a=0;i.length>a;a++)l.canDeactivateItem(i[a],r).then(function(e){o.push(e),o.length==i.length&&n()})}).promise():n()};var r=l.deactivate;return l.deactivate=function(n){return n?e.defer(function(e){function r(r){l.deactivateItem(r,n).then(function(){o++,t.remove(r),o==a&&e.resolve()})}for(var i=t(),o=0,a=i.length,s=0;a>s;s++)r(i[s])}).promise():r()},l},l}var s;return s={defaults:{closeOnDeactivate:!0,interpretResponse:function(e){if("string"==typeof e){var t=e.toLowerCase();return"yes"==t||"ok"==t}return e},areSameItem:function(e,t){return e==t},beforeActivate:function(e){return e},afterDeactivate:function(e,t,n){t&&n&&n(null)}},activator:a}}),n("durandal/composition",["./viewLocator","./viewModelBinder","./viewEngine","./system","./viewModel"],function(e,t,n,r,i){function o(e){return e.model&&e.model.activate&&(f.activateDuringComposition&&void 0==e.activate||e.activate)}function a(e,t){o(e)?i.activator().activateItem(e.model).then(function(e){e&&t()}):t()}function s(e){for(var t=[],n={childElements:t,activeView:null},r=ko.virtualElements.firstChild(e);r;)1==r.nodeType&&(t.push(r),r.getAttribute(u)&&(n.activeView=r)),r=ko.virtualElements.nextSibling(r);return n}function c(e,t,n){n.activeView&&n.activeView.removeAttribute(u),t&&(n.model&&n.model.viewAttached&&(n.composingNewView||n.alwaysAttachView)&&n.model.viewAttached(t),t.setAttribute(u,!0)),n.afterCompose&&n.afterCompose(e,t,n)}function l(e,t){if("string"==typeof t.transition){if(t.activeView){if(t.activeView==e)return!1;if(!e)return!0;if(t.skipTransitionOnSameViewId){var n=t.activeView.getAttribute("data-view"),r=e.getAttribute("data-view");return n!=r}}return!0}return!1}var d={},u="data-active-view",f={activateDuringComposition:!1,convertTransitionToModuleId:function(e){return"durandal/transitions/"+e},switchContent:function(e,t,n){if(n.transition=n.transition||this.defaultTransitionName,l(t,n)){var i=this.convertTransitionToModuleId(n.transition);r.acquire(i).then(function(r){n.transition=r,r(e,t,n).then(function(){c(e,t,n)})})}else t!=n.activeView&&(n.cacheViews&&n.activeView&&$(n.activeView).css("display","none"),t?n.cacheViews?n.composingNewView?(n.viewElements.push(t),ko.virtualElements.prepend(e,t)):$(t).css("display",""):(ko.virtualElements.emptyNode(e),ko.virtualElements.prepend(e,t)):n.cacheViews||ko.virtualElements.emptyNode(e)),c(e,t,n)},bindAndShow:function(e,r,i){i.composingNewView=i.cacheViews?-1==ko.utils.arrayIndexOf(i.viewElements,r):!0,a(i,function(){if(i.beforeBind&&i.beforeBind(e,r,i),i.preserveContext&&i.bindingContext)i.composingNewView&&t.bindContext(i.bindingContext,r,i.model);else if(r){var o=i.model||d,a=ko.dataFor(r);if(a!=o){if(!i.composingNewView)return $(r).remove(),n.createView(r.getAttribute("data-view")).then(function(t){f.bindAndShow(e,t,i)}),void 0;t.bind(o,r)}}f.switchContent(e,r,i)})},defaultStrategy:function(t){return e.locateViewForObject(t.model,t.viewElements)},getSettings:function(e){var t=ko.utils.unwrapObservable(e())||{};if("string"==typeof t)return t;var n=r.getModuleId(t);if(n)return{model:t};for(var i in t)t[i]=ko.utils.unwrapObservable(t[i]);return t},executeStrategy:function(e,t){t.strategy(t).then(function(n){f.bindAndShow(e,n,t)})},inject:function(t,n){return n.model?n.view?(e.locateView(n.view,n.area,n.viewElements).then(function(e){f.bindAndShow(t,e,n)}),void 0):((void 0===n.view||n.view)&&(n.strategy||(n.strategy=this.defaultStrategy),"string"==typeof n.strategy?r.acquire(n.strategy).then(function(e){n.strategy=e,f.executeStrategy(t,n)}):this.executeStrategy(t,n)),void 0):(this.bindAndShow(t,null,n),void 0)},compose:function(t,i,o){"string"==typeof i&&(i=n.isViewUrl(i)?{view:i}:{model:i});var a=r.getModuleId(i);a&&(i={model:i});var c=s(t);i.bindingContext=o,i.activeView=c.activeView,i.cacheViews&&!i.viewElements&&(i.viewElements=c.childElements),i.model?"string"==typeof i.model?r.acquire(i.model).then(function(e){i.model="function"==typeof e?new e(t,i):e,f.inject(t,i)}):f.inject(t,i):i.view?(i.area=i.area||"partial",i.preserveContext=!0,e.locateView(i.view,i.area,i.viewElements).then(function(e){f.bindAndShow(t,e,i)})):this.bindAndShow(t,null,i)}};return ko.bindingHandlers.compose={update:function(e,t,n,r,i){var o=f.getSettings(t);f.compose(e,o,i)}},ko.virtualElements.allowedBindings.compose=!0,f}),n("durandal/widget",["./system","./composition"],function(e,t){var n="data-part",r="["+n+"]",i={},o={},a=["model","view","kind"],s={getParts:function(t){var i={};e.isArray(t)||(t=[t]);for(var o=0;t.length>o;o++){var a=t[o];if(a.getAttribute){var s=a.getAttribute(n);s&&(i[s]=a);for(var c=$(r,a),l=0;c.length>l;l++){var d=c.get(l);i[d.getAttribute(n)]=d}}}return i},getSettings:function(e){var t=ko.utils.unwrapObservable(e())||{};if("string"==typeof t)return t;for(var n in t)t[n]=-1!=ko.utils.arrayIndexOf(a,n)?ko.utils.unwrapObservable(t[n]):t[n];return t},registerKind:function(e){ko.bindingHandlers[e]={init:function(){return{controlsDescendantBindings:!0}},update:function(t,n,r,i,o){var a=s.getSettings(n);a.kind=e,s.create(t,a,o)}},ko.virtualElements.allowedBindings[e]=!0},mapKind:function(e,t,n){t&&(o[e]=t),n&&(i[e]=n)},convertKindToModuleId:function(e){return i[e]||"durandal/widgets/"+e+"/controller"},convertKindToViewId:function(e){return o[e]||"durandal/widgets/"+e+"/view"},beforeBind:function(e,t){var n=s.getParts(e),r=s.getParts(t);for(var i in n)$(r[i]).replaceWith(n[i])},createCompositionSettings:function(e){return e.model||(e.model=this.convertKindToModuleId(e.kind)),e.view||(e.view=this.convertKindToViewId(e.kind)),e.preserveContext=!0,e.beforeBind=this.beforeBind,e},create:function(e,n,r){"string"==typeof n&&(n={kind:n});var i=s.createCompositionSettings(n);t.compose(e,i,r)}};return ko.bindingHandlers.widget={init:function(){return{controlsDescendantBindings:!0}},update:function(e,t,n,r,i){var o=s.getSettings(t);s.create(e,o,i)}},ko.virtualElements.allowedBindings.widget=!0,s}),n("durandal/modalDialog",["./composition","./system","./viewModel"],function(e,t,n){function r(e){return t.defer(function(n){"string"==typeof e?t.acquire(e).then(function(e){"function"==typeof e?n.resolve(new e):n.resolve(e)}):n.resolve(e)}).promise()}var i={},o=0,a={currentZIndex:1050,getNextZIndex:function(){return++this.currentZIndex},isModalOpen:function(){return o>0},getContext:function(e){return i[e||"default"]},addContext:function(e,t){t.name=e,i[e]=t;var n="show"+e.substr(0,1).toUpperCase()+e.substr(1);this[n]=function(t,n){return this.show(t,n,e)}},createCompositionSettings:function(e,t){var n={model:e,activate:!1};return t.afterCompose&&(n.afterCompose=t.afterCompose),n},show:function(a,s,c){var l=this,d=i[c||"default"];return t.defer(function(t){r(a).then(function(r){var i=n.activator();i.activateItem(r,s).then(function(n){if(n){var a=r.modal={owner:r,context:d,activator:i,close:function(){var e=arguments;i.deactivateItem(r,!0).then(function(n){n&&(o--,d.removeHost(a),delete r.modal,t.resolve.apply(t,e))})}};a.settings=l.createCompositionSettings(r,d),d.addHost(a),o++,e.compose(a.host,a.settings)}else t.resolve(!1)})})}).promise()}};return a.addContext("default",{blockoutOpacity:.2,removeDelay:200,addHost:function(e){var t=$("body"),n=$('<div class="modalBlockout"></div>').css({"z-index":a.getNextZIndex(),opacity:this.blockoutOpacity}).appendTo(t),r=$('<div class="modalHost"></div>').css({"z-index":a.getNextZIndex()}).appendTo(t);if(e.host=r.get(0),e.blockout=n.get(0),!a.isModalOpen()){e.oldBodyMarginRight=$("body").css("margin-right");var i=$("html"),o=t.outerWidth(!0),s=i.scrollTop();$("html").css("overflow-y","hidden");var c=$("body").outerWidth(!0);t.css("margin-right",c-o+parseInt(e.oldBodyMarginRight)+"px"),i.scrollTop(s),$("#simplemodal-overlay").css("width",c+"px")}},removeHost:function(e){if($(e.host).css("opacity",0),$(e.blockout).css("opacity",0),setTimeout(function(){$(e.host).remove(),$(e.blockout).remove()},this.removeDelay),!a.isModalOpen()){var t=$("html"),n=t.scrollTop();t.css("overflow-y","").scrollTop(n),$("body").css("margin-right",e.oldBodyMarginRight)}},afterCompose:function(e,t,n){var r=$(t),i=r.width(),o=r.height();r.css({"margin-top":""+-o/2+"px","margin-left":""+-i/2+"px"}),$(n.model.modal.host).css("opacity",1),$(t).hasClass("autoclose")&&$(n.model.modal.blockout).click(function(){n.model.modal.close()}),$(".autofocus",t).each(function(){$(this).focus()})}}),a}),n("durandal/events",["./system"],function(e){var t=/\s+/,n=function(){},r=function(e,t){this.owner=e,this.events=t};return r.prototype.then=function(e,t){return this.callback=e||this.callback,this.context=t||this.context,this.callback?(this.owner.on(this.events,this.callback,this.context),this):this},r.prototype.on=r.prototype.then,r.prototype.off=function(){return this.owner.off(this.events,this.callback,this.context),this},n.prototype.on=function(e,n,i){var o,a,s;if(n){for(o=this.callbacks||(this.callbacks={}),e=e.split(t);a=e.shift();)s=o[a]||(o[a]=[]),s.push(n,i);return this}return new r(this,e)},n.prototype.off=function(n,r,i){var o,a,s,c;if(!(a=this.callbacks))return this;if(!(n||r||i))return delete this.callbacks,this;for(n=n?n.split(t):e.keys(a);o=n.shift();)if((s=a[o])&&(r||i))for(c=s.length-2;c>=0;c-=2)r&&s[c]!==r||i&&s[c+1]!==i||s.splice(c,2);else delete a[o];return this},n.prototype.trigger=function(e){var n,r,i,o,a,s,c,l;if(!(r=this.callbacks))return this;for(l=[],e=e.split(t),o=1,a=arguments.length;a>o;o++)l[o-1]=arguments[o];for(;n=e.shift();){if((c=r.all)&&(c=c.slice()),(i=r[n])&&(i=i.slice()),i)for(o=0,a=i.length;a>o;o+=2)i[o].apply(i[o+1]||this,l);if(c)for(s=[n].concat(l),o=0,a=c.length;a>o;o+=2)c[o].apply(c[o+1]||this,s)}return this},n.prototype.proxy=function(e){var t=this;return function(n){t.trigger(e,n)}},n.includeIn=function(e){e.on=n.prototype.on,e.off=n.prototype.off,e.trigger=n.prototype.trigger,e.proxy=n.prototype.proxy},n}),n("durandal/app",["./system","./viewEngine","./composition","./widget","./modalDialog","./events"],function(e,t,n,r,i,o){var a={title:"Value Samurai",showModal:function(e,t,n){return i.show(e,t,n)},showMessage:function(e,t,n){return i.show("./messageBox",{message:e,title:t||this.title,options:n})},start:function(){var t=this;return t.title&&(document.title=t.title),e.defer(function(t){$(function(){e.log("Starting Application"),t.resolve(),e.log("Started Application")})}).promise()},setRoot:function(e,r,i){var o,a={activate:!0,transition:r};o=i&&"string"!=typeof i?i:document.getElementById(i||"applicationHost"),"string"==typeof e?t.isViewUrl(e)?a.view=e:a.model=e:a.model=e,n.compose(o,a)},adaptToDevice:function(){document.ontouchmove=function(e){e.preventDefault()}}};return o.includeIn(a),a}),n("durandal/plugins/router",["../system","../viewModel","../app"],function(e,t,n){function r(t){P(!1),e.log("Redirecting"),g.navigateTo(t)}function i(){M=!0,e.log("Cancelling Navigation"),y&&m.setLocation(y),M=!1,P(!1);var t=m.last_location[1].split("#/")[1];y||!t?C():t!=w?window.location.replace("#/"+w):C()}function o(e,t,n){B(e),g.onNavigationComplete(e,t,n),b=n,y=m.last_location[1].replace("/",""),C()}function a(t,n,r){e.log("Activating Route",t,r,n),I.activateItem(r,n).then(function(e){e?o(t,n,r):i()})}function s(){return M||m.last_location[1].replace("/","")==y}function c(e,t,n){var o=g.guardRoute(e,t,n);o?o.then?o.then(function(o){o?"string"==typeof o?r(o):a(e,t,n):i()}):"string"==typeof o?r(o):a(e,t,n):i()}function l(){if(!P()){var t=A.shift();A=[],t&&(P(!0),e.acquire(t.routeInfo.moduleId).then(function(e){t.params.routeInfo=t.routeInfo,t.params.router=g;var n=g.getActivatableInstance(t.routeInfo,t.params,e);g.guardRoute?c(t.routeInfo,t.params,n):a(t.routeInfo,t.params,n)}))}}function d(e,t){A.unshift({routeInfo:e,params:t}),l()}function u(e,t){var n=k[e];if(!s()){if(!n){if(!g.autoConvertRouteToModuleId)return g.handleInvalidRoute(e,t),void 0;n={moduleId:g.autoConvertRouteToModuleId(e,t),name:g.convertRouteToName(e)}}d(n,t)}}function f(){u(w,this.params||{})}function p(){u(""+this.app.last_route.path,this.params||{})}function v(){var e,t=this.params||{};if(g.autoConvertRouteToModuleId){var n=this.path.split("#/");if(2==n.length){var r=n[1].split("/");return e=r[0],t.splat=r.splice(1),u(e,t),void 0}}g.handleInvalidRoute(this.app.last_location[1],t)}function h(e){return g.prepareRouteInfo(e),k[""+e.url]=e,T.push(e),e.visible&&(e.isActive=ko.computed(function(){return S()&&I()&&I().__moduleId__==e.moduleId}),O.push(e)),e}var m,g,y,b,w,x,k={},T=ko.observableArray([]),O=ko.observableArray([]),S=ko.observable(!1),P=ko.observable(!1),M=!1,I=t.activator(),B=ko.observable(),A=[],C=function(){C=e.noop,S(!0),g.dfd.resolve(),delete g.dfd};return I.settings.areSameItem=function(){return!1},g={ready:S,allRoutes:T,visibleRoutes:O,isNavigating:P,activeItem:I,activeRoute:B,afterCompose:function(){setTimeout(function(){P(!1),l()},10)},getActivatableInstance:function(e,t,n){return"function"==typeof n?new n:n},useConvention:function(e){e=null==e?"viewmodels":e,e&&(e+="/"),g.convertRouteToModuleId=function(t){return e+g.stripParameter(t)}},stripParameter:function(e){var t=e.indexOf(":"),n=t>0?t-1:e.length;return e.substring(0,n)},handleInvalidRoute:function(t,n){e.log("No Route Found",t,n)},onNavigationComplete:function(e){document.title=n.title?e.caption+" | "+n.title:e.caption},navigateBack:function(){window.history.back()},navigateTo:function(e,t){switch(t=t||"trigger",t.toLowerCase()){case"skip":x=e,m.setLocation(e);break;case"replace":window.location.replace(e);break;default:m.lookupRoute("get",e)?m.setLocation(e):window.location.href=e}},replaceLocation:function(e){this.navigateTo(e,"replace")},convertRouteToName:function(e){var t=g.stripParameter(e);return t.substring(0,1).toUpperCase()+t.substring(1)},convertRouteToModuleId:function(e){return g.stripParameter(e)},prepareRouteInfo:function(e){e.url instanceof RegExp||(e.name=e.name||g.convertRouteToName(e.url),e.moduleId=e.moduleId||g.convertRouteToModuleId(e.url),e.hash=e.hash||"#/"+e.url),e.caption=e.caption||e.name,e.settings=e.settings||{}},mapAuto:function(e){e=e||"viewmodels",e+="/",g.autoConvertRouteToModuleId=function(t){return e+g.stripParameter(t)}},mapNav:function(e,t,n){return"string"==typeof e?this.mapRoute(e,t,n,!0):(e.visible=!0,h(e))},mapRoute:function(e,t,n,r){return"string"==typeof e?h({url:e,moduleId:t,name:n,visible:r}):h(e)},map:function(t){if(!e.isArray(t))return h(t);for(var n=[],r=0;t.length>r;r++)n.push(h(t[r]));return n},activate:function(t){return e.defer(function(n){var r;g.dfd=n,w=t,m=Sammy(function(e){for(var t=T(),n=0;t.length>n;n++){var i=t[n];e.get(i.url,p),r=this.routes.get[n],k[""+r.path]=i}e.get("#/",f),e.get(/\#\/(.*)/,v)}),m._checkFormSubmission=function(){return!1},m.before(null,function(e){if(x){if(e.path==="/"+x)return x=null,!1;throw Error("Expected to skip url '"+x+"', but found url '"+e.path+"'")}return!0}),m.log=function(){var t=Array.prototype.slice.call(arguments,0);t.unshift("Sammy"),e.log.apply(e,t)},m.run("#/")}).promise()}}}),n("services/logger",["durandal/system"],function(e){function t(e,t,n,i){r(e,t,n,i,"info")}function n(e,t,n,i){r(e,t,n,i,"error")}function r(t,n,r,i,o){r=r?"["+r+"] ":"",n?e.log(r,t,n):e.log(r,t),i&&("error"===o?toastr.error(t):toastr.info(t))}var i={log:t,logError:n};return i}),t.config({paths:{text:"durandal/amd/text"}}),n("main",["durandal/app","durandal/viewLocator","durandal/system","durandal/plugins/router","services/logger"],function(e,t,n,r,i){n.debug(!0),e.start().then(function(){toastr.options.positionClass="toast-bottom-right",toastr.options.backgroundpositionClass="toast-bottom-right",r.handleInvalidRoute=function(e){i.logError("No Route Found",e,"main",!0)},r.useConvention(),t.useConvention(),e.adaptToDevice(),e.setRoot("viewmodels/shell","entrance")})}),n("durandal/http",[],function(){return{defaultJSONPCallbackParam:"callback",get:function(e,t){return $.ajax(e,{data:t})},jsonp:function(e,t,n){return-1==e.indexOf("=?")&&(n=n||this.defaultJSONPCallbackParam,e+=-1==e.indexOf("?")?"?":"&",e+=n+"=?"),$.ajax({url:e,dataType:"jsonp",data:t})},post:function(e,t){return $.ajax({url:e,data:ko.toJSON(t),type:"POST",contentType:"application/json",dataType:"json"})}}}),n("text",["module"],function(e){var n,r,i=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],o=/^\s*<\?xml(\s)+version=[\'\"](\d)*.(\d)*[\'\"](\s)*\?>/im,a=/<body[^>]*>\s*([\s\S]+)\s*<\/body>/im,s="undefined"!=typeof location&&location.href,c=s&&location.protocol&&location.protocol.replace(/\:/,""),l=s&&location.hostname,d=s&&(location.port||void 0),u=[],f=e.config&&e.config()||{};return n={version:"2.0.3",strip:function(e){if(e){e=e.replace(o,"");var t=e.match(a);t&&(e=t[1])}else e="";return e},jsEscape:function(e){return e.replace(/(['\\])/g,"\\$1").replace(/[\f]/g,"\\f").replace(/[\b]/g,"\\b").replace(/[\n]/g,"\\n").replace(/[\t]/g,"\\t").replace(/[\r]/g,"\\r").replace(/[\u2028]/g,"\\u2028").replace(/[\u2029]/g,"\\u2029")},createXhr:f.createXhr||function(){var e,t,n;if("undefined"!=typeof XMLHttpRequest)return new XMLHttpRequest;if("undefined"!=typeof ActiveXObject)for(t=0;3>t;t+=1){n=i[t];try{e=new ActiveXObject(n)}catch(r){}if(e){i=[n];break}}return e},parseName:function(e){var t=!1,n=e.indexOf("."),r=e.substring(0,n),i=e.substring(n+1,e.length);return n=i.indexOf("!"),-1!==n&&(t=i.substring(n+1,i.length),t="strip"===t,i=i.substring(0,n)),{moduleName:r,ext:i,strip:t}},xdRegExp:/^((\w+)\:)?\/\/([^\/\\]+)/,useXhr:function(e,t,r,i){var o,a,s,c=n.xdRegExp.exec(e);return c?(o=c[2],a=c[3],a=a.split(":"),s=a[1],a=a[0],!(o&&o!==t||a&&a.toLowerCase()!==r.toLowerCase()||(s||a)&&s!==i)):!0},finishLoad:function(e,t,r,i){r=t?n.strip(r):r,f.isBuild&&(u[e]=r),i(r)},load:function(e,t,r,i){if(i.isBuild&&!i.inlineText)return r(),void 0;f.isBuild=i.isBuild;var o=n.parseName(e),a=o.moduleName+"."+o.ext,u=t.toUrl(a),p=f.useXhr||n.useXhr;!s||p(u,c,l,d)?n.get(u,function(t){n.finishLoad(e,o.strip,t,r)},function(e){r.error&&r.error(e)}):t([a],function(e){n.finishLoad(o.moduleName+"."+o.ext,o.strip,e,r)})},write:function(e,t,r){if(u.hasOwnProperty(t)){var i=n.jsEscape(u[t]);r.asModule(e+"!"+t,"define(function () { return '"+i+"';});\n")}},writeFile:function(e,t,r,i,o){var a=n.parseName(t),s=a.moduleName+"."+a.ext,c=r.toUrl(a.moduleName+"."+a.ext)+".js";n.load(s,r,function(){var t=function(e){return i(c,e)};t.asModule=function(e,t){return i.asModule(e,c,t)},n.write(e,s,t,o)},o)}},"node"===f.env||!f.env&&"undefined"!=typeof process&&process.versions&&process.versions.node?(r=t.nodeRequire("fs"),n.get=function(e,t){var n=r.readFileSync(e,"utf8");0===n.indexOf("﻿")&&(n=n.substring(1)),t(n)}):"xhr"===f.env||!f.env&&n.createXhr()?n.get=function(e,t,r){var i=n.createXhr();i.open("GET",e,!0),f.onXhr&&f.onXhr(i,e),i.onreadystatechange=function(){var n,o;4===i.readyState&&(n=i.status,n>399&&600>n?(o=Error(e+" HTTP status: "+n),o.xhr=i,r(o)):t(i.responseText))},i.send(null)}:("rhino"===f.env||!f.env&&"undefined"!=typeof Packages&&"undefined"!=typeof java)&&(n.get=function(e,t){var n,r,i="utf-8",o=new java.io.File(e),a=java.lang.System.getProperty("line.separator"),s=new java.io.BufferedReader(new java.io.InputStreamReader(new java.io.FileInputStream(o),i)),c="";
try{for(n=new java.lang.StringBuffer,r=s.readLine(),r&&r.length()&&65279===r.charAt(0)&&(r=r.substring(1)),n.append(r);null!==(r=s.readLine());)n.append(a),n.append(r);c=""+n+""}finally{s.close()}t(c)}),n}),n("text!durandal/messageBox.html",[],function(){return'<div class="messageBox">\r\n    <div class="modal-header">\r\n        <h3 data-bind="html: title"></h3>\r\n    </div>\r\n    <div class="modal-body">\r\n        <p class="message" data-bind="html: message"></p>\r\n    </div>\r\n    <div class="modal-footer" data-bind="foreach: options">\r\n        <button class="btn" data-bind="click: function () { $parent.selectOption($data); }, html: $data, css: { \'btn-primary\': $index() == 0, autofocus: $index() == 0 }"></button>\r\n    </div>\r\n</div>'}),n("durandal/messageBox",[],function(){var e=function(t,n,r){this.message=t,this.title=n||e.defaultTitle,this.options=r||e.defaultOptions};return e.prototype.selectOption=function(e){this.modal.close(e)},e.prototype.activate=function(t){t&&(this.message=t.message,this.title=t.title||e.defaultTitle,this.options=t.options||e.defaultOptions)},e.defaultTitle="Application",e.defaultOptions=["Ok"],e}),n("durandal/transitions/entrance",["../system"],function(e){var t=100,n=function(n,r,i){return e.defer(function(e){function o(){e.resolve()}function a(){i.keepScrollPosition||$(document).scrollTop(0)}function s(){a(),i.cacheViews?i.composingNewView&&ko.virtualElements.prepend(n,r):(ko.virtualElements.emptyNode(n),ko.virtualElements.prepend(n,r));var e={marginLeft:"20px",marginRight:"-20px",opacity:0,display:"block"},t={marginRight:0,marginLeft:0,opacity:1};$(r).css(e),$(r).animate(t,l,"swing",o)}if(r){var c=$(i.activeView),l=i.duration||500;c.length?c.fadeOut(t,s):s()}else a(),i.activeView?$(i.activeView).fadeOut(t,function(){i.cacheViews||ko.virtualElements.emptyNode(n),o()}):(i.cacheViews||ko.virtualElements.emptyNode(n),o())}).promise()};return n}),n("services/model",["config"],function(e){function t(e){n(e),r(e)}function n(e){e.addEntityType({shortName:"FootballMatch",namespace:"Samurai",dataProperties:{matchIdentifier:{dataType:c.String},id:{dataType:c.Int64,isPartOfKey:!0},league:{dataType:c.String},season:{dataType:c.String},matchDate:{dataType:c.DateTime},homeTeam:{dataType:c.String},awayTeam:{dataType:c.String},scoreLine:{dataType:c.String},iktsGameWeek:{dataType:c.Int64}},navigationProperties:{predictions:{entityTypeName:"FootballPrediction",isScalar:!0,associationName:"FootballMatch_FootballPrediction"},odds:{entityTypeName:"FootballOdd",isScalar:!1,associationName:"FootballMatch_FootballOdd"}}}),e.addEntityType({shortName:"FootballPrediction",namespace:"Samurai",dataProperties:{matchId:{dataType:c.Int32,isPartOfKey:!0},matchIdentifier:{dataType:c.String},predictionURL:{dataType:c.String},probabilities:{dataType:c.Undefined}},navigationProperties:{footballMatch:{entityTypeName:"FootballMatch",isScalar:!0,associationName:"FootballMatch_FootballPrediction",foreignKeyNames:["matchId"]}}}),e.addEntityType({shortName:"FootballOdd",namespace:"Samurai",dataProperties:{matchId:{dataType:c.Int32,isPartOfKey:!0},sport:{dataType:c.String},outcome:{dataType:c.String,isPartOfKey:!0},oddsBeforeCommission:{dataType:c.Decimal},commissionPct:{dataType:c.Decimal},decimalOdd:{dataType:c.Decimal},timeStamp:{dataType:c.DateTime},bookmaker:{dataType:c.String},oddsSource:{dataType:c.String},clickThroughURL:{dataType:c.String},priority:{dataType:c.Int32}},navigationProperties:{footballMatch:{entityTypeName:"FootballMatch",isScalar:!0,associationName:"FootballMatch_FootballOdd",foreignKeyNames:["matchId"]}}}),e.addEntityType({shortName:"TennisMatch",namespace:"Samurai",dataProperties:{matchIdentifier:{dataType:c.String},id:{dataType:c.Int64,isPartOfKey:!0},tournament:{dataType:c.String},year:{dataType:c.String},matchDate:{dataType:c.DateTime},playerAFirstName:{dataType:c.String},playerASurname:{dataType:c.String},playerBFirstName:{dataType:c.String},playerBSurname:{dataType:c.String},scoreLine:{dataType:c.String}},navigationProperties:{predictions:{entityTypeName:"TennisPrediction",isScalar:!0,associationName:"TennisMatch_TennisPrediction"},odds:{entityTypeName:"TennisOdd",isScalar:!1,associationName:"TennisMatch_TennisOdd"}}}),e.addEntityType({shortName:"TennisPrediction",namespace:"Samurai",dataProperties:{matchId:{dataType:c.Int32,isPartOfKey:!0},sport:{dataType:c.String},matchIdentifier:{dataType:c.String},predictionURL:{dataType:c.String},playerAGames:{dataType:c.Double},playerBGames:{dataType:c.Double},ePoints:{dataType:c.Double},eGames:{dataType:c.Double},eSets:{dataType:c.Double},probabilities:{dataType:c.Undefined},scoreLineProbabilties:{dataType:c.Undefined}},navigationProperties:{tennisMatch:{entityTypeName:"TennisMatch",isScalar:!0,associationName:"TennisMatch_TennisPrediction",foreignKeyNames:["matchId"]}}}),e.addEntityType({shortName:"TennisOdd",namespace:"Samurai",dataProperties:{matchId:{dataType:c.Int32,isPartOfKey:!0},sport:{dataType:c.String},outcome:{dataType:c.String,isPartOfKey:!0},oddsBeforeCommission:{dataType:c.Decimal},commissionPct:{dataType:c.Decimal},decimalOdd:{dataType:c.Decimal},timeStamp:{dataType:c.DateTime},bookmaker:{dataType:c.String},oddsSource:{dataType:c.String},clickThroughURL:{dataType:c.String},priority:{dataType:c.Int32}},navigationProperties:{tennisMatch:{entityTypeName:"TennisMatch",isScalar:!0,associationName:"TennisMatch_TennisOdd",foreignKeyNames:["matchId"]}}})}function r(e){e.registerEntityTypeCtor("TennisMatch",null,a),e.registerEntityTypeCtor("FootballMatch",null,i),e.registerEntityTypeCtor("TennisOdds",null,s),e.registerEntityTypeCtor("FootballOdds",null,o)}function i(e){e.percentBet=ko.observable(0),e.sport=ko.computed(function(){return"Football"}),e.hasOdds=ko.computed(function(){e.hasOwnProperty("odds")&&e.odds()&&e.odds()}),e.tournament=ko.computed(function(){var t=e.league();return t}),e.matchTime=ko.computed(function(){var t=e.matchDate(),n=0===t-l?" --- ":t&&moment.utc(t).isValid()?moment.utc(t).format("DD-MM-YY HH:mm"):" --- ";return n}),e.homeWinProbDbl=ko.computed(function(){var t=e.predictions().probabilities();return t?t.homeWin:0}),e.drawProbDbl=ko.computed(function(){var t=e.predictions().probabilities();return t?t.draw:0}),e.awayWinProbDbl=ko.computed(function(){var t=e.predictions().probabilities();return t?t.awayWin:0}),e.homeWinProb=ko.computed(function(){var t=e.predictions().probabilities();return t&&(100*t.homeWin).toFixed(0)+"%"}),e.drawProb=ko.computed(function(){var t=e.predictions().probabilities();return t&&(100*t.draw).toFixed(0)+"%"}),e.awayWinProb=ko.computed(function(){var t=e.predictions().probabilities();return t&&(100*t.awayWin).toFixed(0)+"%"}),e.homeWinOddsDbl=ko.computed(function(){var t=e.odds();return 0==t.length?1.01:t[0].decimalOdd()}),e.drawOddsDbl=ko.computed(function(){var t=e.odds();return 0==t.length?1.01:t[1].decimalOdd()}),e.awayWinOddsDbl=ko.computed(function(){var t=e.odds();return 0==t.length?1.01:t[2].decimalOdd()}),e.homeWinOdds=ko.computed(function(){var t=e.odds();return 0==t.length?"-":t[0].decimalOdd().toFixed(2)}),e.drawOdds=ko.computed(function(){var t=e.odds();return 0==t.length?"-":t[1].decimalOdd().toFixed(2)}),e.awayWinOdds=ko.computed(function(){var t=e.odds();return 0==t.length?"-":t[2].decimalOdd().toFixed(2)}),e.homeWinEdge=ko.computed(function(){return e.homeWinOddsDbl()*e.homeWinProbDbl()-1}),e.drawEdge=ko.computed(function(){return e.drawOddsDbl()*e.drawProbDbl()-1}),e.awayWinEdge=ko.computed(function(){return e.awayWinOddsDbl()*e.awayWinProbDbl()-1}),e.homeWinClickThrough=ko.computed(function(){var t=e.odds();return 0==t.length?"/":t[0].clickThroughURL()}),e.drawClickThrough=ko.computed(function(){var t=e.odds();return 0==t.length?"/":t[1].clickThroughURL()}),e.awayWinClickThrough=ko.computed(function(){var t=e.odds();return 0==t.length?"/":t[2].clickThroughURL()}),e.homeWinClickThroughLocation=ko.computed(function(){var t=e.odds();return 0==t.length?"No odds":t[0].bookmaker()+" ("+t[0].oddsSource()+")"}),e.drawClickThroughLocation=ko.computed(function(){var t=e.odds();return 0==t.length?"No odds":t[1].bookmaker()+" ("+t[1].oddsSource()+")"}),e.awayWinClickThroughLocation=ko.computed(function(){var t=e.odds();return 0==t.length?"No odds":t[2].bookmaker()+" ("+t[2].oddsSource()+")"}),e.hasQualifyingBet=ko.computed(function(){var t=_.max([e.homeWinEdge(),e.drawEdge(),e.awayWinEdge()]);return t>.1}),e.valueOutcome=ko.computed(function(){if(e.hasQualifyingBet()){var t=_.max([e.homeWinEdge(),e.drawEdge(),e.awayWinEdge()]);if(t===e.homeWinEdge())return"home-win";if(t===e.drawEdge())return"draw";if(t===e.awayWinEdge())return"away-win"}return"no-bet"}),e.valueOdd=ko.computed(function(){if(e.hasQualifyingBet()){var t=_.max([e.homeWinEdge(),e.drawEdge(),e.awayWinEdge()]);if(t===e.homeWinEdge())return e.homeWinOddsDbl();if(t===e.drawEdge())return e.drawOddsDbl();if(t===e.awayWinEdge())return e.awayWinOddsDbl()}return 1.01}),e.valuePrediction=ko.computed(function(){if(e.hasQualifyingBet()){var t=_.max([e.homeWinEdge(),e.awayWinEdge()]);if(t===e.homeWinEdge())return e.homeWinProbDbl();if(t===e.drawEdge())return e.drawProbDbl();if(t===e.awayWinEdge())return e.homeWinProbDbl()}return 0}),e.temporaryBetCaption=ko.computed(function(){if(e.hasQualifyingBet()&&0!==e.percentBet()){if("home-win"===e.valueOutcome())return"Bet £"+(1e3*e.percentBet()).toFixed(2)+" on "+e.homeTeam();if("draw"===e.valueOutcome())return"Bet £"+(1e3*e.percentBet()).toFixed(2)+" on draw";if("away-win"===e.valueOutcome())return"Bet £"+(1e3*e.percentBet()).toFixed(2)+" on "+e.awayTeam()}return""})}function o(){}function a(t){t.percentBet=ko.observable(0),t.sport=ko.computed(function(){return"Tennis"}),t.hasOdds=ko.computed(function(){t.hasOwnProperty("odds")&&t.odds()&&t.odds()}),t.homeTeam=ko.computed(function(){return t.playerASurname()+", "+t.playerAFirstName()}),t.awayTeam=ko.computed(function(){return t.playerBSurname()+", "+t.playerBFirstName()}),t.matchTime=ko.computed(function(){var e=t.matchDate(),n=0===e-l?" --- ":e&&moment.utc(e).isValid()?moment.utc(e).format("DD-MM-YY HH:mm"):" --- ";return n}),t.playerAWinProb=ko.computed(function(){var e=t.predictions().probabilities();return e&&(100*e.homeWin).toFixed(0)+"%"}),t.playerBWinProb=ko.computed(function(){var e=t.predictions().probabilities();return e&&(100*e.awayWin).toFixed(0)+"%"}),t.playerAWinProbDbl=ko.computed(function(){var e=t.predictions().probabilities();return e?e.homeWin:0}),t.playerBWinProbDbl=ko.computed(function(){var e=t.predictions().probabilities();return e?e.awayWin:0}),t.homeWinOddsDbl=ko.computed(function(){var e=t.odds();return 0==e.length?1.01:e[0].decimalOdd()}),t.awayWinOddsDbl=ko.computed(function(){var e=t.odds();return 0==e.length?1.01:e[1].decimalOdd()}),t.homeWinOdds=ko.computed(function(){var e=t.odds();return 0==e.length?"-":e[0].decimalOdd().toFixed(2)}),t.awayWinOdds=ko.computed(function(){var e=t.odds();return 0==e.length?"-":e[1].decimalOdd().toFixed(2)}),t.homeWinEdge=ko.computed(function(){return t.homeWinOddsDbl()*t.playerAWinProbDbl()-1}),t.awayWinEdge=ko.computed(function(){return t.awayWinOddsDbl()*t.playerBWinProbDbl()-1}),t.homeWinClickThrough=ko.computed(function(){var e=t.odds();return 0==e.length?"/":e[0].clickThroughURL()}),t.awayWinClickThrough=ko.computed(function(){var e=t.odds();return 0==e.length?"/":e[1].clickThroughURL()}),t.homeWinClickThroughLocation=ko.computed(function(){var e=t.odds();return 0==e.length?"No odds":e[0].bookmaker()+" ("+e[0].oddsSource()+")"}),t.awayWinClickThroughLocation=ko.computed(function(){var e=t.odds();return 0==e.length?"No odds":e[1].bookmaker()+" ("+e[1].oddsSource()+")"}),t.hasQualifyingBet=ko.computed(function(){if(e.minTennisGames>t.predictions().playerAGames()||e.minTennisGames>t.predictions().playerBGames())return!1;var n=_.max([t.homeWinEdge(),t.awayWinEdge()]);return n>=e.minEdgeTennis}),t.valueOutcome=ko.computed(function(){if(t.hasQualifyingBet()){var e=_.max([t.homeWinEdge(),t.awayWinEdge()]);if(e===t.homeWinEdge())return"home-win";if(e===t.awayWinEdge())return"away-win"}return"no-bet"}),t.valueOdd=ko.computed(function(){if(t.hasQualifyingBet()){var e=_.max([t.homeWinEdge(),t.awayWinEdge()]);if(e===t.homeWinEdge())return t.homeWinOddsDbl();if(e===t.awayWinEdge())return t.awayWinOddsDbl()}return 1.01}),t.valuePrediction=ko.computed(function(){if(t.hasQualifyingBet()){var e=_.max([t.homeWinEdge(),t.awayWinEdge()]);if(e===t.homeWinEdge())return t.playerAWinProbDbl();if(e===t.awayWinEdge())return t.playerBWinProbDbl()}return 0}),t.temporaryBetCaption=ko.computed(function(){if(t.hasQualifyingBet()&&0!==t.percentBet()){if("home-win"===t.valueOutcome())return"Bet £"+(1e3*t.percentBet()).toFixed(2)+" on "+t.homeTeam();if("away-win"===t.valueOutcome())return"Bet £"+(1e3*t.percentBet()).toFixed(2)+" on "+t.awayTeam()}return""})}function s(){}var c=breeze.DataType;breeze.AutoGeneratedKeyType;var l=new Date(1900,0,1),d={configureMetadataStore:t};return d}),n("services/datacontext",["services/logger","durandal/system","services/model","config"],function(e,t,n,r){function i(e,t,n){var r=_.filter(t,function(e){var t=n.predicate(n,e);return t});e(r)}function o(n){var r="Error retreiving data. "+n.message;e.log(r,n,t.getModuleId(h),!0)}function a(){var e=new breeze.JsonResultsAdapter({name:"samurai",extractResults:function(e){var t=e.results;if(!t)throw Error('Unable to resolve "results" property');return t},visitNode:function(e){return e.hasOwnProperty("matchIdentifier")&&e.hasOwnProperty("homeTeam")&&e.hasOwnProperty("awayTeam")?{entityType:"FootballMatch"}:e.hasOwnProperty("probabilities")&&e.hasOwnProperty("playerAGames")&&e.hasOwnProperty("playerBGames")?{entityType:"TennisPrediction"}:e.hasOwnProperty("probabilities")?{entityType:"FootballPrediction"}:e.matchIdentifier&&e.hasOwnProperty("playerAFirstName")&&e.hasOwnProperty("playerBFirstName")?{entityType:"TennisMatch"}:e.hasOwnProperty("decimalOdd")&&"Football"==e.sport?{entityType:"FootballOdd"}:e.hasOwnProperty("decimalOdd")&&"Tennis"==e.sport?{entityType:"TennisOdd"}:void 0}}),t=new breeze.DataService({serviceName:r.remoteServiceName,hasServerMetadata:!1,jsonResultsAdapter:e}),i=new breeze.EntityManager({dataService:t});return n.configureMetadataStore(i.metadataStore),i}function s(n,r,i){e.log(n,r,t.getModuleId(h),i)}var c=breeze.EntityQuery,l=a(),d=function(e,t){function n(n){e&&i(e,n.results,t.filter),s("Fetched football schedule",n,!0)}var r=c.from("fixtures/todays-football-schedule").toType("FootballMatch");if(!t.forceRefresh){var a=l.executeQueryLocally(r);if(a.length>0)return i(e,a,t.filter),Q.resolve()}return l.executeQuery(r).then(n).fail(o)},u=function(e,t){function n(t){e&&e(t.results),s("Fetched football odds",t,!0)}var r=c.from("odds/todays-football-odds").toType("FootballOdd");if(!t.forceRefresh){var i=l.executeQueryLocally(r);if(i.length>0)return e(i),Q.resolve()}return l.executeQuery(r).then(n).fail(o)},f=function(e,t){function n(n){e&&i(e,n.results,t.filter),s("Fetched tennis schedule",n,!0)}var r=c.from("fixtures/todays-tennis-schedule").toType("TennisMatch");if(!t.forceRefresh){var a=l.executeQueryLocally(r);if(a.length>0)return i(e,a,t.filter),Q.resolve()}return l.executeQuery(r).then(n).fail(o)},p=function(e,t){function n(t){e&&e(t.results),s("Fetched tennis odds",t,!0)}var r=c.from("odds/todays-tennis-odds").toType("TennisOdd");if(!t.forceRefresh){var i=l.executeQueryLocally(r);if(i.length>0)return e(i),Q.resolve()}return l.executeQuery(r).then(n).fail(o)},v=function(){return Q.all([])},h={getTodaysFootballSchedule:d,getTodaysLatestFootballOdds:u,getTodaysTennisSchedule:f,getTodaysLatestTennisOdds:p,primeData:v};return h}),n("services/utils",[],function(){function e(e){return e.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")}function t(e){return e.toLowerCase().replace(/[^\w ]+/g,"").replace(/ +/g,"-")}var n={regExEscape:e,convertToSlug:t};return n}),n("services/filter",["services/utils","config"],function(e,t){var n=function(){var e=this;return e.valueBetsOnly=ko.observable(!1),e.sportSlug=ko.observable(),e.tournamentSlug=ko.observable(),e.searchText=ko.observable().extend({throttle:t.throttle}),e};return n.prototype=function(){var t=function(t,n){if(!t)return!0;var r=e.regExEscape(t.toLowerCase());return-1!==n.homeTeam().toLowerCase().search(r)?!0:-1!==n.awayTeam().toLowerCase().search(r)?!0:-1!==n.tournament().toLowerCase().search(r)?!0:!1},n=function(e,t){if(e){var n=t.hasQualifyingBet();return n}return!0},r=function(t,n,r){return t&&0!==t.length&&t!==e.convertToSlug(r.sport())||n&&0!==n.length&&n!==e.convertToSlug(r.tournament())?!1:!0},i=function(e,i){var o=t(e.searchText(),i)&&n(e.valueBetsOnly(),i)&&r(e.sportSlug(),e.tournamentSlug(),i);return o};return{predicate:i}}(),n}),n("services/groupSchedule",["config","services/utils"],function(e,t){function n(n,r,i){_.reduce(n,function(n,r){var o=r.tournament?r.tournament():r.league(),a=t.convertToSlug(i),s=t.convertToSlug(o),c=e.hashes.todayByCompetition;return n.index[o]||(n.index[o]=!0,n.sched.push({caption:o,sportSlug:a,sport:i,competitionSlug:s,competition:o,hash:c+"/"+s,isSelected:ko.observable()})),n},{index:{},sched:r})}var r=function(t,r){e.hashes.todayByCompetition;var i=e.hashes.todayBySport,o=[];return o.push({caption:"Today",sport:"",sportSlug:"",competition:"",competitionSlug:"",hash:e.hashes.today,isSelected:ko.observable()}),r.length>0&&(o.push({caption:"Tennis",sport:"Tennis",sportSlug:"tennis",competition:"",competitionSlug:"",hash:i+"/tennis",isSelected:ko.observable()}),n(r,o,"Tennis")),t.length>0&&(o.push({caption:"Football",sport:"Football",sportSlug:"football",competition:"",competitionSlug:"",hash:i+"/football",isSelected:ko.observable()}),n(t,o,"Football")),o};return{schedulesToHeadings:r}}),n("services/jsonResultsAdapter",new breeze.JsonResultsAdapter({name:"samurai",extractResults:function(e){var t=e.results;if(!t)throw Error('Unable to resolve "results" property');return t},visitNode:function(e){return e.hasOwnProperty("matchIdentifier")&&e.hasOwnProperty("homeTeam")&&e.hasOwnProperty("awayTeam")?{entityType:"FootballMatch"}:e.hasOwnProperty("probabilities")&&e.hasOwnProperty("playerAGames")&&e.hasOwnProperty("playerBGames")?{entityType:"TennisPrediction"}:e.hasOwnProperty("probabilities")?{entityType:"FootballPrediction"}:e.matchIdentifier&&e.hasOwnProperty("playerAFirstName")&&e.hasOwnProperty("playerBFirstName")?{entityType:"TennisMatch"}:e.hasOwnProperty("decimalOdd")&&"Football"==e.sport?{entityType:"FootballOdd"}:e.hasOwnProperty("decimalOdd")&&"Tennis"==e.sport?{entityType:"TennisOdd"}:void 0}})),n("services/jsonResultsAdapter",function(){}),n("services/kellyCalcs",[],function(){return function(){var e,t,n,r,i={}.hasOwnProperty,o=function(e,t){function n(){this.constructor=e}for(var r in t)i.call(t,r)&&(e[r]=t[r]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e};return e=function(){function e(e,t){this.odds=e,this.prob=t,this.edge=this.odds*this.prob-1}return e}(),n=function(){function e(){}return e.singleKellyStakes=function(e,t){return e?e.map(function(e){return e.edge>=this.minEdge?Math.max((Math.pow((e.odds-1)*e.prob,t)-Math.pow(1-e.prob,t))/(Math.pow(e.win*e.prob,t)+(e.odds-1)*Math.pow(1-e.prob,t)),0):0}):void 0},e}(),r=function(e){function t(e,t,n){this.kellyMultiplier=e,this.minEdge=t,this.calculatedBets=null!=n?n:[],this.noBets=this.calculatedBets.length,this.singleKellyStakes,this.realKellyStakes}var n,r,i;return o(t,e),i=200,r=200,n=300,t.prototype.calcSingleKellyStakes=function(e,t,n){return e.map(function(e){return e.edge>=n?Math.max((Math.pow((e.odds-1)*e.prob,t)-Math.pow(1-e.prob,t))/(Math.pow((e.odds-1)*e.prob,t)+(e.odds-1)*Math.pow(1-e.prob,t)),0):0})},t.prototype.sum=function(e){return 0===e.length?0:e.reduce(function(e,t){return e+t})},t.prototype.sign=function(e){return e&&e/Math.abs(e)},t.prototype.normaliseKelly=function(e){var t;return t=this.sum(e),e.map(function(e){return t>1?e/t:e})},t.prototype.learningRate=function(e,t,n){return n||(n=0),n*(this.sign(e)===this.sign(t)?1.05:.95)},t.prototype.slopes=function(e,t){var n,r,o,a,s,c,l,d,u,f,p,v,h,m,g,y,b,w;for(o=[],s=[],r=[],u=[],c=[],l=p=0;e>p;l=p+=1){for(d=[],f=[],t=v=0,y=this.noBets;y>v;t=v+=1)a=Math.random(),n=this.calculatedBets[t],n.prob>a?(d[t]=n.odds-1,f[t]=(n.odds-1)*this.realKellyStakes[t]):(d[t]=-1,f[t]=-this.realKellyStakes[t]);for(o[l]=this.sum(f),s[l]=o[l]+1,r[l]=Math.log(s[l])/i,t=h=0,b=this.noBets;b>h;t=h+=1)u[l]||(u[l]=[]),u[l][t]=d[t]/(i*s[l])}for(t=m=0,w=this.noBets;w>m;t=m+=1)for(c[t]=0,e=g=0;i>g;e=g+=1)c[t]+=u[e][t];return c},t.prototype.calculateKelly=function(){var e,t,n,o,a,s,c,l,d,u,f,p,v,h,m,g,y,b;for(this.singleKellyStakes=this.calcSingleKellyStakes(this.calculatedBets,1,0),this.realKellyStakes=this.normaliseKelly(this.singleKellyStakes),t=[],a=[],d=[],f=[],o=[],n=[],c=p=0;r>p;c=p+=1){for(l=this.slopes(i,this.noBets),e=v=0,g=this.noBets;g>v;e=v+=1)a[e]=0===c?1:this.learningRate(n[e],l[e],n[e]),d[e]=this.singleKellyStakes[e]-this.realKellyStakes[e],f[e]=this.sign(l[e])*a[e]*d[e],o[e]=this.realKellyStakes[e]+f[e];for(u=this.sum(o),s=u>1?.99/u:1,e=h=0,y=this.noBets;y>h;e=h+=1)this.realKellyStakes[e]=0>o[e]?0:o[e]*s;t=a,n=l}if(1!==this.kellyMultiplier)for(e=m=0,b=this.noBets;b>m;e=m+=1)this.realKellyStakes[e]=this.kellyMultiplier*this.realKellyStakes[e];return this.realKellyStakes},t}(n),t=function(e){function t(e,t,n){this.kellyMultiplier=e,this.minEdge=t,this.calculatedBets=null!=n?n:[],this.realKellyStakes}return o(t,e),t.prototype.calcSingleKellyStakes=function(e,t,n){return e?e.map(function(e){return!n||e.edge>=n?Math.max((Math.pow((e.odds-1)*e.prob,t)-Math.pow(1-e.prob,t))/(Math.pow((e.odds-1)*e.prob,t)+(e.odds-1)*Math.pow(1-e.prob,t)),0):0}):void 0},t.prototype.bitImp=function(e,t){return~e|t},t.prototype.toRadix=function(e,t){var n,r,i;for(n="",r=Math.floor(Math.abs(e)),i=void 0;;)if(i=r%t,n="0123456789abcdefghijklmnopqrstuvwxyz".charAt(i)+n,r=(r-i)/t,0===r)break;return 0>e?"-"+n:n},t.prototype.parlaySize=function(e){return this.toRadix(e,2).split("").reduce(function(e,t){return parseInt(e)+parseInt(t)})},t.prototype.calculateKelly=function(){var e,t,n,r,i,o,a,s,c,l,d,u,f,p,v,h,m,g,y,b,w,x,k,T;for(p=this.calculatedBets.length,e=Math.pow(2,p)-1,f=[],s=[],a=[],d=[],f=this.calcSingleKellyStakes(this.calculatedBets,this.kellyMultiplier,this.minEdge),t=m=0;p>m;t=m+=1)a[t]=[];for(t=g=1;e>=g;t=g+=1)o=parseInt(this.parlaySize(t)),a[o-1].push(t);for(u=y=p;y>=1;u=y+=-1)for(i=a[u-1].length,t=b=0;i>b;t=b+=1){for(c=a[u-1][t],d[c]=1,s[c]="",r=w=0;p>w;r=w+=1)-1===this.bitImp(Math.pow(2,r),c)&&(d[c]*=f[r],s[c]+=r+1+"+");for(v=x=T=u+1;p>=x;v=x+=1)for(h=a[v-1].length,n=k=0;h>k;n=k+=1)l=a[v-1][n],-1===this.bitImp(c,l)&&(d[c]-=d[l])}var O=_.filter(_.zip(s,d),function(e){return e[0]&&2===e[0].length});return _.map(O,function(e){return e[1]})},t}(n),{Kelly:n,CalculatedBet:e,ExhaustiveKelly:t,WhitrowKelly:r}}()}),n("services/signalr",["services/datacontext","config"],function(e,t){function n(){u=$.connection.oddsHub,$.connection.hub.url=t.signalrServiceName,$.connection.hub.start().done(function(){c("Connected to hub!")}).fail(function(){c("Failed to connect to hub!")}),r()}function r(){u.client.reportProgress=i,u.client.getMissingTournamentCouponURLs=a,u.client.getMissingTeamPlayerAlias=s}function i(e){var t=c();c(e+"\n"+t)}function o(e){u.server.fetchTennisSchedules(e),i("Sent request for tennis schedules")}function a(){i("This would return a list of missing tournament coupon URLs")}function s(){i("This would return a list of missing team or player alias")}var c=ko.observable(),l=ko.observable(),d=ko.observable(),u=void 0;return{progress:c,missingTournamentCouponURLs:l,missingTeamPlayerAlias:d,connectHubs:n,reportProgress:i,fetchTennisSchedules:o}}),n("services/valueCalculator",["services/kellyCalcs","config"],function(e,t){var n=function(){var e=this;return e.isCalculating=ko.observable(!1),e.progress=ko.observable(),e.betPercentages=ko.observableArray(),e};return n.prototype=function(){var n=function(n,r){var i,o=_.filter(n,function(e){return e.hasQualifyingBet()}),a=_.filter(r,function(e){return e.hasQualifyingBet()}),s=_.union(o,a),c=_.map(s,function(t){return{id:t.id(),calcBet:new e.CalculatedBet(t.valueOdd(),t.valuePrediction())}});i=c.length>=t.exhaustiveKellyLimit?new e.WhitrowKelly(t.kellyMultiplier,0,_.map(c,function(e){return e.calcBet})):new e.ExhaustiveKelly(t.kellyMultiplier,0,_.map(c,function(e){return e.calcBet}));var l=i.calculateKelly();return _.object(_.map(c,function(e){return e.id}),l)};return{calculateValue:n}}(),n}),n("viewmodels/admin",["services/signalr"],function(e){var t=ko.observable(moment().format("YYYY-MM-DD")),n=ko.observableArray(["tennis","football"]),r=ko.observable("tennis"),i=ko.observableArray(["fixtures","results"]),o=ko.observable("fixtures"),a=ko.observable(!1),s=ko.observable(""),c=!1,l=function(){e.fetchTennisSchedules(t()),a(!0)},d=function(){return c||(e.connectHubs(),c=!0),u(),Q.resolve()},u=function(){e.progress.subscribe(function(e){s(e)})},f={title:"Admin",scheduleDateString:t,sports:n,sport:r,fixtureOptions:i,fixtureOption:o,showProgress:a,progressReport:s,updateFixturesResultsOdds:l,activate:d};return f}),n("viewmodels/home",["services/logger"],function(e){function t(){return e.log("Home View Activated",null,"home",!0),!0}var n={activate:t,title:"Home View"};return n}),n("viewmodels/performance",["services/logger","config"],function(e,t){function n(){return a||(a=!0),!0}function r(){s=dc.bubbleChart("#daily-bubble-chart","group"),c=dc.pieChart("#profit-or-loss-chart","group"),l=dc.rowChart("#bets-by-surface-chart","group"),d=dc.rowChart("#bets-by-series-chart","group"),u=dc.barChart("#edge-chart","group"),f=dc.barChart("#games-played-chart","group"),d3.csv("content/Performance.csv",function(e){var n=d3.time.format("%d-%m-%Y"),r=d3.format(".2f"),a=1;e.forEach(function(e){e.day=n.parse(e.MatchDate),e.stake=t.kellyMultiplier*t.startBank*(e.MatchOutcomeProbability*e.OddAfterCommission-1)/(e.OddAfterCommission-1),e.flatProfit=e.stake*(e.ExpectedMatchOutcome==e.ObservedMatchOutcome?e.OddAfterCommission-1:-1),e.odds=1*e.OddAfterCommission,e.identifier=a,e.id=function(){return e.identifier},e.hasQualifyingBet=function(){return!0},e.valueOdd=function(){return e.odds},e.valuePrediction=function(){return e.MatchOutcomeProbability},a++});var p=crossfilter(e),v=p.groupAll(),h=p.dimension(function(e){return e.identifier}),m=p.dimension(function(e){var t=Math.round(100*(e.MatchOutcomeProbability*e.OddAfterCommission-1));return t}),g=m.group(),y=p.dimension(function(e){return Math.min(1*e.PlayerAGames,1*e.PlayerBGames)}),b=y.group(),w=p.dimension(function(e){return d3.time.day(e.day)}),x=w.group().reduce(function(e,t){++e.bets,e.stake+=t.stake,e.profit+=t.flatProfit,e.totalOdd+=t.odds,e.avOdd=0==e.bets?0:e.totalOdd/e.bets;var n=t.ExpectedMatchOutcome==t.ObservedMatchOutcome,i="Home Win"==t.ExpectedMatchOutcome?t.PlayerASurname:t.PlayerBSurname,o="Home Win"==t.ExpectedMatchOutcome?t.PlayerBSurname:t.PlayerASurname;return e.matches[i+" to bt. "+o]=i+" to bt. "+o+" @ "+t.TournamentName+(n?" WON ":" LOST ")+" (£"+r(t.flatProfit)+")",e},function(e,t){--e.bets,e.stake-=t.stake,e.profit-=t.flatProfit,e.totalOdd-=t.odds,e.avOdd=0==e.bets?0:e.totalOdd/e.bets;var n="Home Win"==t.ExpectedMatchOutcome?t.PlayerASurname:t.PlayerBSurname,r="Home Win"==t.ExpectedMatchOutcome?t.PlayerBSurname:t.PlayerASurname;return delete e.matches[n+" to bt. "+r],e},function(){return{bets:0,stake:0,profit:0,totalOdd:0,avOdd:0,matches:{},dailyKellyData:{}}}),k=p.dimension(function(e){switch(e.Surface){case"Hard":return"0.Hard";case"Clay":return"1.Clay";case"Grass":return"2.Grass"}}),T=k.group(),O=p.dimension(function(e){return e.flatProfit>=0?"Profit":"Loss"}),S=O.group(),P=p.dimension(function(e){switch(e.Series){case"Grand Slam":return"0.Grand Slam";case"Masters":return"1.Masters";case"ATP":return"2.ATP"}return e.Series}),M=P.group(),I=new Date(2012,12,1),B=new Date(2013,9,30);s.width(1100).height(400).margins({top:10,right:50,bottom:30,left:50}).dimension(w).group(x).transitionDuration(1500).colors(["#a60000","#ff0000","#ff4040","#ff7373","#67e667","#39e639","#00cc00"]).colorDomain([-400,400]).colorAccessor(function(e){return e.value.profit}).keyAccessor(function(e){return e.key}).valueAccessor(function(e){return e.value.profit}).radiusValueAccessor(function(e){return e.value.stake}).maxBubbleRelativeSize(.02).x(d3.scale.linear().domain([I,B])).y(d3.scale.linear().domain([-300,400])).r(d3.scale.linear().domain([0,250])).elasticY(!0).xAxisPadding(0).yAxisPadding(50).renderHorizontalGridLines(!0).renderVerticalGridLines(!0).renderLabel(!0).renderTitle(!0).label(function(e){return r(e.value.profit)}).title(function(e){var t="";for(var n in e.value.matches)t+=e.value.matches[n]+"\n";return t}).renderlet(function(e){i(e)}),s.xAxis().tickFormat(function(e){return new Date(e).toLocaleDateString()}),s.yAxis().tickFormat(function(e){return"£"+e}),c.width(160).height(180).radius(80).dimension(O).colors(["#ff7373","#67e667"]).group(S).label(function(e){return c.hasFilter()&&!c.hasFilter(e.data.key)?e.data.key+"(0%)":e.data.key+" ("+Math.floor(100*(e.data.value/v.value()))+"%)"}).title(function(e){return e.data.value+("Profit"==e.data.key?" winning":" losing")+" bets"}),l.width(160).height(180).margins({top:20,left:10,right:10,bottom:20}).group(T).dimension(k).colors(["#6baed6","darkorange","lightgreen"]).label(function(e){return e.key.split(".")[1]}).title(function(e){return(e.value+" bets on "+e.key.split(".")[1]).toLowerCase()}).elasticX(!0).xAxis().ticks(4),d.width(160).height(180).margins({top:20,left:10,right:10,bottom:20}).group(M).dimension(P).colors(["lightblue","gold","silver"]).label(function(e){return e.key.split(".")[1]}).title(function(e){return e.value+" bets on the "+e.key.split(".")[1]+" tour"}).elasticX(!0).xAxis().ticks(4),u.width(260).height(180).margins({top:10,right:50,bottom:30,left:40}).dimension(m).group(g).elasticY(!0).centerBar(!0).gap(1).round(dc.round.floor).x(d3.scale.linear().domain([0,150])).renderHorizontalGridLines(!0).filter([20,150]).xAxis().tickFormat(function(e){return e}),f.width(260).height(180).margins({top:10,right:50,bottom:30,left:40}).dimension(y).group(b).elasticY(!0).centerBar(!0).gap(1).round(dc.round.floor).x(d3.scale.linear().domain([0,150])).renderHorizontalGridLines(!0).filter([70,150]).xAxis().tickFormat(function(e){return e}),dc.dataTable(".dc-data-table","group").dimension(h).group(function(e){var t=e.TournamentName+" ("+e.Series+" - "+e.Surface.toLowerCase()+" court)";return t}).size(100).columns([function(e){return e.day.toLocaleDateString()},function(e){var t="Home Win"==e.ExpectedMatchOutcome?e.PlayerASurname:e.PlayerBSurname,n="Home Win"==e.ExpectedMatchOutcome?e.PlayerBSurname:e.PlayerASurname;return t+" to bt. "+n},function(e){return(100*e.MatchOutcomeProbability).toFixed(2)+"%"},function(e){return e.OddAfterCommission},function(e){return e.BookmakerName},function(e){return(100*(e.MatchOutcomeProbability*e.OddAfterCommission-1)).toFixed(2)+"%"},function(e){return o(250*(e.MatchOutcomeProbability*e.OddAfterCommission-1)/(e.OddAfterCommission-1))},function(e){return e.ObservedMatchOutcome==e.ExpectedMatchOutcome?"Won":"Lost"},function(e){return o(e.stake*(e.ExpectedMatchOutcome==e.ObservedMatchOutcome?e.OddAfterCommission-1:-1))}]).sortBy(function(e){return e.day.getTime()}).renderlet(function(e){e.selectAll(".dc-table-group").classed("info",!0)}),dc.filterAll(),dc.renderAll("group")})}function i(e){var t=0,n=0,r=0;e.group().all().forEach(function(e){t+=e.value.stake,n+=e.value.profit,r+=e.value.bets}),$("#outcome").fadeOut(function(){$(this).text(r+" bets, totalling £"+o(t.toFixed(2))+", returned a "+(n>=0?"profit":"loss")+" of £"+o(n.toFixed(2))+" giving an ROI of "+(0==t?"0":(100*n/t).toFixed(2))+"%")}).fadeIn()}function o(e){var t=(""+e).split(".");return t[0].replace(/\B(?=(\d{3})+(?!\d))/g,",")+(t[1]?"."+t[1].substring(0,2):"")}var a=!1,s=null,c=null,l=null,d=null,u=null,f=null,p={activate:n,title:"Performance",viewAttached:r,dailyBubbleChart:s,profitOrLossChart:c,betsBySurfaceChart:l,betsBySeriesChart:d,edgeChart:u,gamesPlayedChart:f};
return p}),n("viewmodels/shell",["durandal/system","durandal/plugins/router","services/logger","config","services/datacontext"],function(e,t,n,r,i){function o(){a("#free-bets-button","#free-bets"),a("#blog-button","#free-bets","http://blog.valuesamurai.com"),a("#today-button","#insert-sections"),a("#performance-button","#insert-sections")}function a(e,t,n){$(e).click(function(){n&&window.open(n),$("html, body").animate({scrollTop:$(t).position().top-60},"slow")})}function s(){return i.primeData().then(c).fail(l)}function c(){return d("Fetching schedules..",null,e.getModuleId(f),!0),t.map(r.routes),t.activate(r.startModule)}function l(t){var r="App initialisation failed: "+t.message;n.logError(r,t,e.getModuleId(f),!0)}function d(t,r,i){n.log(t,r,e.getModuleId(f),i)}var u=ko.computed(function(){return t.allRoutes().filter(function(e){return e.settings.admin})}),f={viewAttached:o,activate:s,adminRoutes:u,router:t};return f}),n("viewmodels/today",["services/datacontext","services/groupSchedule","durandal/plugins/router","services/filter","services/valueCalculator"],function(e,t,n,r,i){function o(t){return Q.resolve().then(function(){return f()?e.getTodaysFootballSchedule(a,t):Q.resolve()}).then(function(){return p()?e.getTodaysTennisSchedule(s,t):Q.resolve()}).then(function(){return f()?e.getTodaysLatestFootballOdds(c,t):Q.resolve()}).then(function(){return p()?e.getTodaysLatestTennisOdds(l,t):Q.resolve()}).fin(function(){haveChecked||(f(a().length>0),p(s().length>0),haveChecked=!0)})}var a=ko.observableArray(),s=ko.observableArray(),c=ko.observableArray(),l=ko.observableArray(),d=new r,u=new i,f=ko.observable(!0),p=ko.observable(!0),v=!1;todaysMatchesCount=ko.computed(function(){return a().length+s().length}),competitions=ko.computed(function(){return t.schedulesToHeadings(a(),s())}),calculateValue=function(){var e=u.calculateValue(a(),s()),t=_.union(a(),s());t.forEach(function(t){if(e[t.id()]){var n=e[t.id()];t.percentBet(n)}})},clearFilter=function(){d.searchText("")},activate=function(){return v||(addFilterSubscriptions(),v=!0),o(dataOptions(!1))},selectGrouping=function(e){d.sportSlug(e.sportSlug),d.tournamentSlug(e.competitionSlug)},refresh=function(){return o(dataOptions(!0))},addFilterSubscriptions=function(){d.valueBetsOnly.subscribe(onFilterChange),d.sportSlug.subscribe(onFilterChange),d.tournamentSlug.subscribe(onFilterChange),d.searchText.subscribe(onFilterChange)},onFilterChange=function(){return activate()},dataOptions=function(e){return{filter:d,forceRefresh:e}},v=!1,haveChecked=!1;var h={title:"Todays fixtures",activate:activate,todaysFootballSchedules:a,todaysTennisSchedules:s,todaysFootballOdds:c,todaysTennisOdds:l,todaysMatchesCount:todaysMatchesCount,competitions:competitions,refresh:refresh,betFilter:d,clearFilter:clearFilter,selectGrouping:selectGrouping};return h}),n("text!views/admin.html",[],function(){return'<section id="admin-view" class="view">\r\n  <header>\r\n    <h2 class="page-title" data-bind="text: title"></h2>\r\n  </header>\r\n  <article class="article-admin-sections">\r\n    <h3>Fixtures, results and odds</h3>\r\n    <div>\r\n      <label class="inline-label">Update all</label>\r\n      <select class="inline-input" data-bind="options: sports, value: sport"></select>\r\n      <select class="inline-input" data-bind="options: fixtureOptions, value: fixtureOption"></select>\r\n      <label class="inline-label">from</label>\r\n      <input class="inline-input" type="date" name="football-schedule" data-bind="value: scheduleDateString"/>\r\n      <a class="btn btn-info btn-force-refresh inline-button"\r\n        data-bind="click: updateFixturesResultsOdds" href="#"><i class="icon-refresh"></i> Update</a>\r\n    </div>\r\n  </article>\r\n  <div data-bind="visible: showProgress">\r\n    <textarea class="big" data-bind="value: progressReport" rows="15" />\r\n    <br />\r\n  </div>\r\n</section>\r\n'}),n("text!views/footer.html",[],function(){return'<section id="free-bets">\r\n  <div id="free-bets-container">\r\n    <h2>Free Bets</h2>\r\n    <h1>Coming soon</h1>\r\n  </div>\r\n</section>\r\n'}),n("text!views/home.html",[],function(){return'<section>\r\n    <h2 class="page-title" data-bind="text: title"></h2>\r\n</section>'}),n("text!views/nav.html",[],function(){return'<nav class="navbar white-paper">\r\n	<div class="navbar-inner text-center">\r\n    <div class="btn-group" data-bind="foreach: router.visibleRoutes">\r\n        <a data-bind="css: { active: isActive }, attr: { href: hash, id: settings.id }, text: name" \r\n            class="btn btn-info top-navo" href="#/"></a>\r\n    </div>\r\n    <!--<div class="loader pull-right" data-bind="css: { active: router.isNavigating }">\r\n      <div class="progress progress-striped active page-progress-bar">\r\n        <div class="bar" style="width: 100px;"></div>\r\n      </div>\r\n    </div>-->\r\n	</div>\r\n	<img id="top-paint" src="content/images/top-paint.png" alt="top-paint" />\r\n</nav>\r\n<header>\r\n	<div id="elevator-pitch" class="white-paper">\r\n		<h2 class="page-title"><img id="val-sam" class="logo-img" src="content/images/val-sam.png" alt="Value Samurai" /></h2>\r\n			<h1>Automated Betting Value Calculator</h1>\r\n			<p>We take <strong>tennis</strong> and <strong>football</strong> predictions from <a href="http://www.tennisbetting365.com">Tennis Betting 365</a> and <a href="http://www.dectech.co.uk/football.html">Decision Technology</a>, respectively.</p>\r\n    	<p>We calculate the best value bets from a variety of bookmakers and betting exchanges.</p>\r\n			<p>This project is (soon to be) <strong>open source</strong>. If you\'d like to contribute, please visit our <a href="https://github.com">GitHub repository</a>.</p>\r\n    	<p>For further information, follow our <a href="http://blog.valuesamurai.com">blog</a>.</p>			    \r\n	</div>\r\n	<img id="bottom-paint" src="content/images/bottom-paint.png" alt="top-paint" />\r\n</header>'}),n("text!views/performance.html",[],function(){return'<section id="performance-anchor" class="main-content-info">\r\n  <h2 class="text-center">Model Performance</h2>\r\n  <p>The chart below details how Tennis Betting 365 has performed in 2013. The model is more reliable with more data, so we set a floor of 70 matches in the past 18 months for both players.</p>\r\n  <p>We take bets with a perceived edge of 20% over bookmaker\'s prices.</p>\r\n  <p>Dectech football model and previous year\'s analysis coming soon...</p>\r\n  <p id="outcome">Crunching the numbers, please be patient...</p>\r\n  <div class="white-section">\r\n    <div class="row margin-clear">\r\n      <div id="daily-bubble-chart" class="chart">\r\n        <strong>Daily bet performance</strong> (x: date, y: flat profit, radius: bet size)\r\n\r\n        <div class="clearfix"></div>\r\n      </div>\r\n    </div>\r\n    <div class="row margin-clear">\r\n      <div id="profit-or-loss-chart" class="col-lg-2">\r\n        <strong>Bets by profit/loss</strong>\r\n\r\n        <div class="clearfix"></div>\r\n      </div>\r\n      <div id="bets-by-surface-chart" class="col-lg-2">\r\n        <strong>Bets by surface</strong>\r\n\r\n        <div class="clearfix"></div>\r\n      </div>\r\n      <div id="bets-by-series-chart" class="col-lg-2">\r\n        <strong>Bets by series</strong>\r\n\r\n        <div class="clearfix"></div>\r\n      </div>\r\n      <div id="edge-chart" class="col-lg-3">\r\n        <strong>Bets by edge</strong>\r\n\r\n        <div class="clearfix"></div>\r\n      </div>\r\n      <div id="games-played-chart" class="col-lg-3">\r\n        <strong>Min games</strong>\r\n            \r\n        <div class="clearfix"></div>\r\n      </div>            \r\n    </div>\r\n    <div class="row margin-clear">\r\n      <table class="table table-hover dc-data-table">\r\n        <thead>\r\n          <tr class="header">\r\n            <th>Date</th>\r\n            <th>Match</th>\r\n            <th>Probability</th>\r\n            <th>Odds</th>\r\n            <th>Bookmaker</th>\r\n            <th>Edge</th>\r\n            <th>Stake</th>\r\n            <th>Outcome</th>\r\n            <th>Profit</th>\r\n          </tr>\r\n        </thead>\r\n      </table>\r\n    </div>\r\n  </div>\r\n</section>'}),n("text!views/shell.html",[],function(){return"<div>\r\n  \r\n  <!--ko compose: {view: 'nav'} --><!--/ko-->\r\n\r\n  <section id=\"insert-sections\" class=\"main\">\r\n    <!--ko compose: {model: router.activeItem, \r\n        afterCompose: router.afterCompose, \r\n        transition: 'entrance'} -->\r\n    <!--/ko-->\r\n  </section>\r\n  <footer>\r\n    <!--ko compose: {view: 'footer'} --><!--/ko-->\r\n  </footer>\r\n</div>\r\n"}),n("text!views/today.html",[],function(){return'<div id="todays-matches-anchor" class="main-content-info">\r\n	<h2 class="text-center">Today\'s Matches</h2>\r\n	<p>We calculate today\'s value bets using the simultaneous <a href="http://en.wikipedia.org/wiki/Kelly_criterion">Kelly Criterion</a>.</p>\r\n	<p>Where more than <span>9</span> bets occur in a single day we switch to Chris Whitrow\'s <a href="http://www.academia.edu/1027427/Algorithms_for_optimal_allocation_of_bets_on_many_simultaneous_events">algorithm</a> for estimated bet sizes.</p>\r\n</div>	\r\n<div class="main-banner-container text-center">\r\n	<div class="main-banner">\r\n\r\n	</div>\r\n</div>\r\n		\r\n<div class="row">\r\n	<div class="col-lg-3">\r\n    <nav>\r\n      <ul id="side-bar" class="nav nav-pills nav-stacked white-section" data-bind="foreach: competitions">\r\n        <li data-bind="css: { \'active\': isSelected() }">\r\n          <a>\r\n            <span data-bind="text: caption, click: $parent.selectGrouping"></span>\r\n            <span class="pull-right"><i class="icon-chevron-right"></i></span>\r\n          </a>\r\n        </li>\r\n      </ul>\r\n    </nav>\r\n	</div>\r\n	<div class="col-lg-9 white-section">\r\n    <div class="filter-box-container">\r\n      <input class="filter-box"\r\n              data-bind="value: betFilter.searchText, valueUpdate: \'afterkeydown\', escape: clearFilter"\r\n              placeholder="filter by team, player, league, competition or sport" type="text" />\r\n      <a class="clear-text" data-bind="click: clearFilter" title="Clear"><i class="icon-remove"></i></a>\r\n    </div>\r\n    <div id="action-wrapper">\r\n      <a id="calculate-value" class="btn btn-info btn-force-refresh pull-right" \r\n          data-bind="click: calculateValue" href="#"><i class="icon-refresh"></i> Calculate Bets</a>\r\n      <div class="match-counter">\r\n        <span data-bind="text: todaysMatchesCount"></span>\r\n        <span>found</span>\r\n      </div>\r\n    </div>\r\n		<section id="matches-collection-tennis" data-bind="foreach: todaysTennisSchedules">\r\n			<div class="match">\r\n				<div class="match-header">\r\n					<small class="pull-left" data-bind="text: tournament"></small>\r\n					<small class="pull-right" data-bind="text: matchTime"></small>\r\n				</div>\r\n				<div class="match-content">\r\n					<div class="row">\r\n					  <div class="col-lg-4 text-right"><div class="team" data-bind="text: homeTeam"></div></div>\r\n					  <div class="col-lg-4 text-center"><div class="vs">vs.</div></div>\r\n					  <div class="col-lg-4 text-left"><div class="team" data-bind="text: awayTeam"></div></div>\r\n					</div>\r\n					<div class="row">\r\n					  <div class="col-lg-4 text-right"><div class="prob" data-bind="text: playerAWinProb"></div></div>\r\n					  <div class="col-lg-4 text-center"><div class="prob"></div></div>\r\n					  <div class="col-lg-4 text-left"><div class="prob" data-bind="text: playerBWinProb"></div></div>\r\n					</div>						\r\n					<div class="row">\r\n						<div class="col-lg-4 text-right"><div class="odd"><a data-bind="attr: { href: homeWinClickThrough, title: homeWinClickThroughLocation, target: \'_blank\' }, text: homeWinOdds"></a></div></div>\r\n						<div class="col-lg-4 text-center"><div class="odd">Best Odds</div></div>\r\n						<div class="col-lg-4 text-left"><div class="odd"><a data-bind="attr: { href: awayWinClickThrough, title: awayWinClickThroughLocation, target: \'_blank\' }, text: awayWinOdds"></a></div></div>\r\n					</div>\r\n					<div class="row" data-bind="with: predictions">\r\n						<div class="col-lg-4 text-right"><div class="match-count" data-bind="text: playerAGames"></div></div>\r\n						<div class="col-lg-4 text-center"><div class="match-count">Matches (last 18 months)</div></div>\r\n						<div class="col-lg-4 text-left"><div class="match-count" data-bind="text: playerBGames"></div></div>\r\n					</div>\r\n          <div class="row">\r\n            <div class="col-lg-12 text-center">\r\n              <span class="advice" data-bind="text: temporaryBetCaption"></span>\r\n            </div>\r\n          </div>	\r\n				</div>\r\n			</div>	 <!--Match div-->		\r\n		</section>\r\n    <section id="matches-collection-football" data-bind="foreach: todaysFootballSchedules">\r\n			<div class="match">\r\n				<div class="match-header">\r\n					<small class="pull-left" data-bind="text: league"></small>\r\n					<small class="pull-right" data-bind="text: matchTime"></small>\r\n				</div>\r\n				<div class="match-content">\r\n					<div class="row">\r\n					  <div class="col-lg-4 text-right"><div class="team" data-bind="text: homeTeam"></div></div>\r\n					  <div class="col-lg-4 text-center"><div class="vs">vs.</div></div>\r\n					  <div class="col-lg-4 text-left"><div class="team" data-bind="text: awayTeam"></div></div>\r\n					</div>\r\n					<div class="row">\r\n						<div class="col-lg-4 text-right"><div class="outcome">Home win</div></div>\r\n						<div class="col-lg-4 text-center"><div class="outcome">Draw</div></div>\r\n						<div class="col-lg-4 text-left"><div class="outcome">Away win</div></div>\r\n					</div>								\r\n					<div class="row">\r\n					  <div class="col-lg-4 text-right"><div class="prob" data-bind="text: homeWinProb"></div></div>\r\n					  <div class="col-lg-4 text-center"><div class="prob" data-bind="text: drawProb"></div></div>\r\n					  <div class="col-lg-4 text-left"><div class="prob" data-bind="text: awayWinProb"></div></div>\r\n					</div>						\r\n					<div class="row">\r\n						<div class="col-lg-4 text-right"><div class="odd"><a data-bind="attr: { href: homeWinClickThrough, title: homeWinClickThroughLocation, target: \'_blank\' }, text: homeWinOdds"></a></div></div>\r\n						<div class="col-lg-4 text-center"><div class="odd"><a data-bind="attr: { href: drawClickThrough, title: drawClickThroughLocation, target: \'_blank\' }, text: drawOdds"></a></div></div>\r\n						<div class="col-lg-4 text-left"><div class="odd"><a data-bind="attr: { href: awayWinClickThrough, title: awayWinClickThroughLocation, target: \'_blank\' }, text: awayWinOdds"></a></div></div>\r\n					</div>\r\n          <div class="row">\r\n            <div class="col-lg-12 text-center">\r\n              <span class="advice" data-bind="text: temporaryBetCaption"></span>\r\n            </div>\r\n          </div>				\r\n				</div>\r\n			</div>	 <!--Match div-->	\r\n    </section>\r\n	</div>\r\n</div>'}),t(["main"])})();